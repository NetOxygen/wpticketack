{"version":3,"sources":["app/Articles/Article.js"],"names":["define","dependencies","postal","$","_","TKTApi","Article","$container","state","_id","data","$triggers","$closers","$modal","$variants","$submit","$error","$submit_error","prototype","attach","init","_this","click","e","show_variants","hide_variants","$total","map","v","v_id","$sub","$add","$quantity","price","parseFloat","hide_errors","html","parseInt","toFixed","Math","max","add_to_cart","fadeIn","fadeOut","show_error","show_submit_error","err","build_articles_to_add","article","quantity","variants","push","_this2","articles","console","log","isEmpty","addArticlesToCart","status","rsp","errorMsg","loadCart","emit_cart_update","CartModel","detach"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Handle Article buy\n *\n * Usage:\n *\n * <div\n *    <!-- Required -->\n *    data-component=\"Articles/Article\"\n *    data-id=\"12345678-1234-1234-1234-123456789012\"\n * >\n *   <[*] class=\"show-variants\"><[*]>\n * </div>\n */\ndefine(\n    ['postal', 'jquery', 'lodash', 'api', 'bootstrap'],\n    function dependencies(postal, $, _, TKTApi) {\n\n        function Article($container, state) {\n            this.$container = $container;\n\n            this._id = this.$container.data('id');\n\n            this.$triggers     = $('.show-variants', this.$container);\n            this.$closers      = $('.close-variants', this.$container);\n            this.$modal        = $('.article-variants-form', this.$container);\n            this.$variants     = $('.variant-wrapper', this.$container);\n            this.$submit       = $('.variants-submit', this.$container);\n            this.$error        = $('.variants-error', this.$container);\n            this.$submit_error = $('.variants-submit-error', this.$container);\n        }\n\n        Article.prototype = {\n            attach: function() {\n                this.init();\n            },\n\n            init: function() {\n                this.$triggers.click((e) => this.show_variants(e));\n                this.$closers.click((e) => this.hide_variants(e));\n\n                const $total = $('.variant-total', this.$container);\n\n                _.map(this.$variants, (v) => {\n                    const v_id = $(v).data('id');\n\n                    const $sub      = $('.variant-sub', $(v));\n                    const $add      = $('.variant-add', $(v));\n                    const $quantity = $('.variant-quantity', $(v));\n                    const price     = parseFloat($('.variant-price', $(v)).data('price'));\n\n                    $add.click((e) => {\n                        this.hide_errors();\n                        $quantity.html(parseInt($quantity.html()) + 1);\n                        $total.html((parseFloat($total.html()) + price).toFixed(2));\n                    });\n\n                    $sub.click((e) => {\n                        $quantity.html(Math.max(0, parseInt($quantity.html()) - 1));\n                        $total.html(parseFloat(($total.html()) - price).toFixed(2));\n                    });\n                });\n\n                const $submit = $('.variants-submit', this.$container);\n                $submit.click((e) => {\n                    this.add_to_cart();\n                });\n            },\n\n            show_variants: function (e) {\n                this.$modal.fadeIn();\n            },\n\n            hide_variants: function (e) {\n                this.$modal.fadeOut();\n            },\n\n            show_error: function() {\n                this.$error.fadeIn();\n            },\n\n            show_submit_error: function(err) {\n                this.$submit_error.html(err).fadeIn();\n            },\n\n            hide_errors: function() {\n                this.$error.fadeOut();\n                this.$submit_error.fadeOut();\n            },\n\n            build_articles_to_add: function() {\n                let article = {\n                    \"_id\": this._id,\n                    \"variants\": []\n                };\n                _.map(this.$variants, (v) => {\n                    const v_id = $(v).data('id');\n\n                    const $quantity = $('.variant-quantity', $(v));\n                    const quantity  = parseInt($quantity.html());\n                    if (quantity <= 0)\n                        return false;\n\n                    const price = parseFloat($('.variant-price', $(v)).data('price'));\n\n                    article.variants.push({\n                        \"_id\": v_id,\n                        \"quantity\": quantity,\n                        \"price\": price\n                    });\n                });\n\n                return [ article ];\n            },\n\n            add_to_cart: function() {\n                const articles = this.build_articles_to_add();\n                console.log(articles);\n\n                if (_.isEmpty(articles[0].variants)) {\n                    this.show_error();\n                    return false;\n                }\n\n                // Add to cart\n                TKTApi.addArticlesToCart(articles, (err, status, rsp) => {\n                    this.hide_variants();\n                    if (err)\n                        return this.show_submit_error(rsp.errorMsg);\n\n                    // Reload and emit cart update\n                    TKTApi.loadCart((err, status, rsp) => {\n                        if (err)\n                            return;\n\n                        this.emit_cart_update(new CartModel(rsp));\n                    });\n                });\n            },\n\n            detach: function() {\n\n            }\n        };\n\n        return Article;\n    });\n"]}