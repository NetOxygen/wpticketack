{"version":3,"sources":["app/Pass/BuyForm.js"],"names":["e","a","_typeof","Symbol","iterator","exports","define","amd","moment","this","obj","l","dependencies","$container","Object","prototype","toString","call","$pass","t","$wrappers","$fields","$","length","Template","BuyForm","sync_pass_form","init","L","_this","h","add_to_cart","data","valueOf","c","each","va","s","utc","_pf","TKTApi","unusedTokens","userdata","_","overflow","postal","charsLeftOver","channel","nullInput","no_photo","addPassToCart","userInvalidated","iso","parsedDateParts","publish","meridiem","rfc2822","fields","weekdayMismatch","show_error","detach","msg","empty","invalidMonth","invalidWeekday","invalidFormat","w","bigHour","isFrozen","field","_isValid"],"mappings":"CAAA,SAAAA,EAAAC,GAAAC,iBAAAC,SAAA,oBAAAA,OAAAC,OAAAC,QAAAJ,IAAA,mBAAAK,QAAAA,OAAAC,IAAAD,OAAA,SAAA,GAAAL,GAAAD,EAAAQ,OAAAP,IAAA,CAAAQ,KAAA,WAAA,aAAA,IAAAT,EAAAU,EAAA,SAAAC,qPAcO,SAASC,EAAAA,GAKwB,MAC3BC,iBAAaA,GADc,oBAAAC,OAAAC,UAAAC,SAAAC,KAAAjB,GAAA,SAK5BkB,EAAAA,GAKJ,OAAAlB,aAAAE,MAAmB,kBAAnBY,OAAAC,UAAAC,SAAAC,KAAAjB,GAVgC,SAc5Be,EAAAA,EAAAA,GACe,IAAAI,EACfC,EAAAA,GADe,IADHC,EAAAA,EACGF,EADHG,EAAAC,SAAAJ,EAjBhBK,EAAAA,KAAAA,EAAAA,EAAAA,GAAAA,IAsBiBC,OACbV,EACSW,SAETJ,EAAAA,EAAEK,GAFOD,OADAR,OAAAA,UAAAA,eAAAA,KAAAA,EAAAA,GADI,SAAAU,EAAA5B,EAAA6B,GAAA,IALD,IAAAV,KAAAD,EAAAY,EAAA7B,EAehB8B,KAAaL,EAAAA,GAAAA,EAAAA,IAVI,OAWbI,EAAA7B,EAAA,cAAAD,EAAAsB,SAA+BU,EAAAA,UADXF,EAAA7B,EAAA,aAAAD,EAAAiC,QAAAhC,EAAAgC,SAAAjC,EAAA,SAAAkC,EAAAlC,EAGlBmC,EAAAA,EAAOJ,GAHW,OAVPK,GAAApC,EAAAC,EAAAkB,EAAAkB,GAAA,GAAAC,MACJpB,SASWa,EAAAA,GAOA,OAAA,MAAA/B,EAAAuC,MAAAvC,EAAAuC,IAAA,CACpBC,OAAAA,EAAwEC,aACpEC,GAAAC,YACI,GAAuBC,UAE3BC,EAF2BC,cAGvBC,EAHuBC,WAHX,EAKDN,aAJqDO,KAAAT,eARpDU,EAAAC,iBAfR,EAAAC,KAAA,EAeQC,gBAfRC,GAAAC,SAsChB7B,KAtCgB8B,SAuCRC,EAvCQC,iBAeQ,IAAA1D,EAQoDwC,IAjB/DtB,SAgCmByC,EAAAA,GAtChB,GA8ChBC,MAAQC,EAARD,SA9CgB,CAMH1C,IAAAA,EAAAA,EAAAA,GAAAA,EAAAA,EAAAA,KAAAA,EAAAA,gBAAAA,SAAAA,GA6CjBQ,OAnE0C,MAAAA,IAP9CpB,GAAAA,MAAAA,EAAAA,GAAAA,YAAAA,EAAAA,SAAAA,IAO8CL,EAAA6D,QAAA7D,EAAA8D,eAAA9D,EAAA+D,iBAAA/D,EAAAyD,kBAAAzD,EAAA+C,YAAA/C,EAAAgE,gBAAAhE,EAAAkD,mBAAAlD,EAAAsD,UAAAtD,EAAAsD,UAAApC,GAwDlCwB,GAAER,EAAFQ,UAAYvB,EAAZuB,GAAuB,IAACuB,EAADpB,eAAO,IAAA7C,EAAAwC,aAAAlB,aAAA,IAAAtB,EAAAkE,SAAA,MAAArD,OAAAsD,UAAAtD,OAAAsD,SAAApE,GAC1B,OAAIqE,EADsBrE,EAAAsE,SAErBb,EA1DyB,OAsBzBvC,EAAAA,SAwCM,SAxCNA,EAAAA,GAvBbM,IAAAA,EAAAA,EAAAA,KAoEJ,OAAOC,MApEHD,EAAAA,EAAAA,EAAAA,GAAAA,GAAAA,EAAAA,GAAAA,iBAAAA,EAAAA","file":"app.js","sourcesContent":["/**\n * Show a pass buy form\n *\n * Usage:\n *\n * <div\n *    <!-- Required -->\n *    data-component=\"Pass/BuyForm\"\n * >\n */\ndefine( [\n        'config', 'postal', 'lodash',\n        'template', 'jquery', 'api',\n        'moment', 'Cart', 'Screening', 'Ticket'\n    ], function dependencies(\n        config, postal, _,\n        Template, $, TKTApi,\n        moment, CartModel, Screening, Ticket) {\n\n    function BuyForm($container, state) {\n        this.$container = $container;\n        this.$pass      = $('.pass', this.$container);\n\n        // Ensure $pass is always an array\n        if ('object' === typeof this.$pass)\n            this.$pass = [this.$pass];\n\n        this.$selected_pass = this.$pass[0];\n\n        this.$wrappers = $('.field-wrapper', this.$container);\n        this.$fields   = $('.field-wrapper .field', this.$container);\n    }\n\n    BuyForm.prototype = {\n        attach: function() {\n            this.init();\n        },\n\n        init: function() {\n            if (this.$pass.length == 1)\n                this.sync_pass_form(this.$pass[0].data('type'));\n\n            $('button[type=\"submit\"]', this.$container).click((e) => {\n                e.preventDefault();\n                this.add_to_cart();\n            });\n        },\n\n        add_to_cart: function() {\n            let type = this.$selected_pass.data('type');\n            let userdata = {};\n            _.each($('.field:visible', this.$container), (f) => {\n                let name = $(f).attr('id').replace('user_', '');\n                userdata[name] = $(f).val();\n            });\n            userdata.no_photo = true;\n            TKTApi.addPassToCart(type, 'fullprice', userdata, (err, status, rsp) => {\n                if (err)\n                    return this.show_error('Une erreur est survenue');\n\n                postal.publish({\n                    channel: \"cart\",\n                    topic: \"reload\"\n                });\n            });\n        },\n\n        show_error(msg) {\n            alert(msg);\n        },\n\n        sync_pass_form: function (pass) {\n            let fields = $('#' + pass + '-fields').val().split(',');\n            _.each(this.$wrappers, (w) => {\n                let field = $(w).attr('id').replace('field-wrapper-', '');\n                $(w)[fields.includes(field) ? 'fadeIn' : 'hide']();\n            });\n        },\n\n        detach: function() {\n\n        }\n    };\n\n    return BuyForm;\n});\n"]}