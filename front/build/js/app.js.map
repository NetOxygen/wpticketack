{"version":3,"sources":["app/Booking/Form.js"],"names":["define","dependencies","config","postal","_","Template","$","TKTApi","moment","CartModel","Screening","Ticket","Form","$container","state","initialized","ids","data","split","show_on_load","prototype","attach","_this","init_store","click","e","preventDefault","deinit","init","subscribe","channel","topic","callback","envelope","check_bookability","_this2","getScreeningsInfo","err","status","rsp","screenings","map","s","sortBy","start_at","build_form","screening","pricings","pass_infos","ticket","bookability","reset_store_on_screening_change","html","emit_cart_update","cart","publish","emit_connection_update","process_add_to_cart","_this3","addClass","chosen_pricings","find","nb","removeClass","addToCart","_id","errorMsg","loadCart","book","_this4","Error","flash","error","success","connect_pass","_this5","number","key","loginTicket","_this6","checkBookability","ticket_logged_in","ticket_can_book_screening","msg","screening_already_booked","$dates_form","appendTo","$tickets_form","$success_panel","build_dates_form","build_success_panel","_this7","render","$date","target","select_screening","build_tickets_form","_this8","change","$input","parseInt","val","bind","program_url","get","cart_url","screening_id","detach"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Show a booking form\n *\n * Usage:\n *\n * <div\n *    <!-- Required -->\n *    data-component=\"Booking/Form\"\n *    data-ids=\"12345678-1234-1234-1234-123456789012,...\"\n * >\n */\ndefine( [\n        'config', 'postal', 'lodash',\n        'template', 'jquery', 'api',\n        'moment', 'Cart', 'Screening', 'Ticket'\n    ], function dependencies(\n        config, postal, _,\n        Template, $, TKTApi,\n        moment, CartModel, Screening, Ticket) {\n\n    function Form($container, state) {\n        this.$container  = $container;\n        this.initialized = false;\n\n        this.ids          = this.$container.data('ids').split(',');\n        this.show_on_load = this.$container.data('show-on-load');\n    }\n\n    Form.prototype = {\n        attach: function() {\n            this.init_store();\n\n            $('.show-booking-form').click((e) => {\n                e.preventDefault();\n\n                if (this.initialized)\n                    return this.deinit();\n\n                this.init();\n            });\n\n            postal.subscribe({\n                channel: \"connection\",\n                topic: \"update\",\n                callback: (data, envelope) => {\n                    this.check_bookability();\n                }\n            });\n\n            if (this.show_on_load)\n                this.init();\n        },\n\n        init: function() {\n            TKTApi.getScreeningsInfo(this.ids, (err, status, rsp) => {\n                this.data.screenings = rsp.map((s) => new Screening(s));\n                this.data.screenings = _.sortBy(this.data.screenings, (s) => s.start_at);\n                this.build_form();\n                this.initialized = true;\n            });\n        },\n\n        init_store: function() {\n            this.data = {\n                screenings: [], // current screenings\n                screening: {},  // selected screening\n                pricings: [],   // selected screening pricings\n                pass_infos: {}, // connection infos\n                ticket: {},     // active ticket\n                bookability: {} //selected screening bookability with  active ticket\n            };\n        },\n\n        reset_store_on_screening_change: function() {\n            this.data.screening   = {};\n            this.data.pricings    = {};\n            this.data.pass_infos  = {};\n            this.data.bookability = {};\n        },\n\n        deinit: function() {\n            this.$container.html(\"\");\n            this.initialized = false;\n        },\n\n        emit_cart_update: function(cart) {\n            postal.publish({\n                channel: \"cart\",\n                topic: \"update\",\n                data: {\n                    cart: cart\n                }\n            });\n        },\n\n        emit_connection_update: function(ticket) {\n            postal.publish({\n                channel: \"connection\",\n                topic: \"update\",\n                data: {\n                    ticket: ticket\n                }\n            });\n        },\n\n        process_add_to_cart: function() {\n            $('.pricings-error').html(\"\").addClass('d-none');\n\n            // Check chosen pricings\n            const chosen_pricings = _.find(this.data.pricings, (nb) => nb > 0);\n            if (!chosen_pricings) {\n                return $('.pricings-error')\n                    .html('Veuillez choisir au moins un billet')\n                    .removeClass('d-none');\n            }\n\n            // Add to cart\n            TKTApi.addToCart(\n                this.data.screening._id,\n                this.data.pricings,\n                (err, status, rsp) => {\n                    if (err) {\n                        return $('.pricings-error')\n                            .html(rsp.errorMsg)\n                            .removeClass('d-none');\n                    }\n\n                // Hide forms and show success message\n                $('.dates-form, .tickets-form').addClass('d-none');\n                $('.success-panel').removeClass('d-none');\n\n                // Reload and emit cart update\n                TKTApi.loadCart((err, status, rsp) => {\n                    if (err)\n                        return;\n\n                    this.emit_cart_update(new CartModel(rsp));\n                });\n            });\n        },\n\n        book: function() {\n            if (!this.data.screening._id)\n                return new Error(\"No screening\");\n\n            TKTApi.book(this.data.screening._id, (err, status, rsp) => {\n                if (err) {\n                    $('.book-form-success', this.$container).addClass('d-none');\n                    $('.book-form-error', this.$container)\n                        .html(\"Une erreur est survenue. Veuillez ré-essayer ultérieurement.\")\n                        .removeClass('d-none');\n                } else if (rsp.flash && rsp.flash.error) {\n                    $('.book-form-success', this.$container).addClass('d-none');\n                    $('.book-form-error', this.$container)\n                        .html(rsp.flash.error)\n                        .removeClass('d-none');\n                } else {\n                    $('.book-form-error', this.$container).addClass('d-none');\n                    $('.book-form-success', this.$container)\n                        .html(rsp.flash.success)\n                        .removeClass('d-none');\n                }\n\n                this.check_bookability();\n            });\n        },\n\n        connect_pass: function() {\n            $('.pass-error', this.$container).html(\"\").addClass('d-none');\n\n            if (!this.data.pass_infos.number || !this.data.pass_infos.key)\n                return $('.pass-error')\n                    .html('Veuillez remplir les deux champs')\n                    .removeClass('d-none');\n\n            TKTApi.loginTicket(\n                this.data.pass_infos.number,\n                this.data.pass_infos.key,\n                (err, status, rsp) => {\n                    if (err)\n                        return $('.pass-error')\n                            .html('Les informations que vous avez saisies sont invalides')\n                            .removeClass('d-none');\n\n                    this.data.ticket = new Ticket(rsp);\n                    this.emit_connection_update(this.data.ticket);\n                }\n            );\n        },\n\n        check_bookability: function(callback) {\n            if (!this.data.screening._id)\n                return new Error(\"No screening\");\n\n            TKTApi.checkBookability(this.data.screening._id, (err, status, rsp) => {\n                if (err)\n                    return false;\n\n                this.data.bookability = rsp;\n\n                if (this.data.bookability.ticket_logged_in) {\n                    $('.connect-panel', this.$container).addClass('d-none');\n                    $('.book-panel', this.$container).removeClass('d-none');\n                    $('.show-bookings-btn', this.$container).removeClass('d-none');\n\n                    if (this.data.bookability.ticket_can_book_screening) {\n                        $('.book-btn', this.$container).removeClass('d-none');\n                        $('.book-form-error', this.$container).addClass('d-none');\n                    } else {\n                        $('.book-btn', this.$container).addClass('d-none');\n                        const msg = this.data.bookability.screening_already_booked ?\n                            \"Vous ne pouvez pas réserver plus de place pour cette séance avec votre abonnement.\" :\n                            \"Vous ne pouvez pas réserver de place pour cette séance avec votre abonnement.\";\n                        $('.book-form-error', this.$container)\n                            .html(msg)\n                            .removeClass('d-none');\n                    }\n                } else {\n                    $('.connect-panel', this.$container).removeClass('d-none');\n                    $('.book-panel', this.$container).addClass('d-none');\n                }\n            });\n        },\n\n        build_form: function() {\n            this.$container.html(\"\");\n            this.$dates_form    = $('<div class=\"dates-form\"></div>').appendTo(this.$container);\n            this.$tickets_form  = $('<div class=\"tickets-form\"></div>').appendTo(this.$container);\n            this.$success_panel = $('<div class=\"success-panel d-none\"></div>').appendTo(this.$container);\n\n            this.build_dates_form();\n            this.build_success_panel();\n        },\n\n        build_dates_form: function() {\n            // render template\n            this.$dates_form.html(Template.render('tkt-booking-form-dates-tpl', {\n                screenings: this.data.screenings,\n            }));\n\n            // bind dates choices\n            $('.date-wrapper span.date').click((e) => {\n                const $date = $(e.target);\n                this.select_screening($date.data('screening_id'));\n            });\n\n            // Select first date\n            this.select_screening(this.data.screenings[0]._id);\n        },\n\n        build_tickets_form: function() {\n            // render template\n            this.$tickets_form.html(Template.render('tkt-booking-form-pricings-tpl', {\n                screening: this.data.screening,\n            }));\n\n            // bind pricing fields\n            $('.pricing-input', this.$container).change((e) => {\n              const $input = $(e.target);\n              this.data.pricings[$input.data('pricing')] = parseInt($input.val());\n            });\n\n            // bind pass panel toggler\n            $('a.show-connect-panel-form', this.$container).click((e) => {\n                e.preventDefault();\n                $('.connect-panel-form').removeClass('d-none');\n            });\n\n            // bind pass fields\n            $('.pass-number-input,.pass-key-input', this.$container).change((e) => {\n              this.data.pass_infos = {\n                number: $('.pass-number-input', this.$container).val(),\n                key: $('.pass-key-input', this.$container).val()\n              };\n            });\n\n            // bind pass connect button\n            $('.connect-btn', this.$container).click(this.connect_pass.bind(this));\n\n            // bind book button\n            $('.book-btn').click(this.book.bind(this));\n\n            // bind add-to-cart button\n            $('.add-to-cart-btn').click((e) => {\n              this.process_add_to_cart();\n            });\n        },\n\n        build_success_panel: function() {\n            // render template\n            this.$success_panel.html(Template.render('tkt-booking-form-success-tpl', {\n                program_url: config.get('program_url'),\n                cart_url: config.get('cart_url')\n            }));\n        },\n\n        select_screening: function (screening_id) {\n            $('.date-wrapper .date').removeClass('active');\n            $('.date-wrapper .date[data-screening_id=\"' + screening_id + '\"]').addClass('active');\n\n            // reset data\n            this.reset_store_on_screening_change();\n\n            this.data.screening = _.find(this.data.screenings, (s) => s._id === screening_id );\n            this.build_tickets_form();\n\n            this.check_bookability();\n        },\n\n        detach: function() {\n\n        }\n    };\n\n    return Form;\n});\n"]}