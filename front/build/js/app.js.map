{"version":3,"sources":["app/Booking/Form.js"],"names":["define","dependencies","config","postal","_","Template","$","TKTApi","moment","CartModel","Screening","Ticket","Form","$container","state","initialized","ids","data","split","show_on_load","prototype","attach","_this","init_store","click","e","preventDefault","deinit","init","subscribe","channel","topic","callback","envelope","check_bookability","_this2","getScreeningsInfo","err","status","rsp","screenings","map","s","screening","eligible_types","sortBy","start_at","build_form","pricings","pass_infos","ticket","bookability","reset_store_on_screening_change","html","emit_cart_update","cart","publish","emit_connection_update","process_add_to_cart","_this3","addClass","chosen_pricings","find","nb","removeClass","addToCart","_id","errorMsg","loadCart","book","_this4","Error","flash","error","success","connect_pass","_this5","number","key","loginTicket","_this6","checkBookability","ticket_logged_in","ticket_can_book_screening","msg","screening_already_booked","$dates_form","appendTo","$tickets_form","$success_panel","build_dates_form","build_success_panel","_this7","render","$date","target","select_screening","build_tickets_form","_this8","change","$input","parseInt","val","bind","program_url","get","cart_url","screening_id","detach"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Show a booking form\n *\n * Usage:\n *\n * <div\n *    <!-- Required -->\n *    data-component=\"Booking/Form\"\n *    data-ids=\"12345678-1234-1234-1234-123456789012,...\"\n * >\n */\ndefine( [\n        'config', 'postal', 'lodash',\n        'template', 'jquery', 'api',\n        'moment', 'Cart', 'Screening', 'Ticket'\n    ], function dependencies(\n        config, postal, _,\n        Template, $, TKTApi,\n        moment, CartModel, Screening, Ticket) {\n\n    function Form($container, state) {\n        this.$container  = $container;\n        this.initialized = false;\n\n        this.ids          = this.$container.data('ids').split(',');\n        this.show_on_load = this.$container.data('show-on-load');\n    }\n\n    Form.prototype = {\n        attach: function() {\n            this.init_store();\n\n            $('.show-booking-form').click((e) => {\n                e.preventDefault();\n\n                if (this.initialized)\n                    return this.deinit();\n\n                this.init();\n            });\n\n            postal.subscribe({\n                channel: \"connection\",\n                topic: \"update\",\n                callback: (data, envelope) => {\n                    this.check_bookability();\n                }\n            });\n\n            if (this.show_on_load)\n                this.init();\n        },\n\n        init: function() {\n            TKTApi.getScreeningsInfo(this.ids, (err, status, rsp) => {\n                this.data.screenings = rsp.map((s) => {\n                    let screening = new Screening(s);\n                    screening.eligible_types = s.eligible_types;\n\n                    return screening;\n                });\n                this.data.screenings = _.sortBy(this.data.screenings, (s) => s.start_at);\n                this.build_form();\n                this.initialized = true;\n            });\n        },\n\n        init_store: function() {\n            this.data = {\n                screenings: [], // current screenings\n                screening: {},  // selected screening\n                pricings: [],   // selected screening pricings\n                pass_infos: {}, // connection infos\n                ticket: {},     // active ticket\n                bookability: {} //selected screening bookability with  active ticket\n            };\n        },\n\n        reset_store_on_screening_change: function() {\n            this.data.screening   = {};\n            this.data.pricings    = {};\n            this.data.pass_infos  = {};\n            this.data.bookability = {};\n        },\n\n        deinit: function() {\n            this.$container.html(\"\");\n            this.initialized = false;\n        },\n\n        emit_cart_update: function(cart) {\n            postal.publish({\n                channel: \"cart\",\n                topic: \"update\",\n                data: {\n                    cart: cart\n                }\n            });\n        },\n\n        emit_connection_update: function(ticket) {\n            postal.publish({\n                channel: \"connection\",\n                topic: \"update\",\n                data: {\n                    ticket: ticket\n                }\n            });\n        },\n\n        process_add_to_cart: function() {\n            $('.pricings-error').html(\"\").addClass('d-none');\n\n            // Check chosen pricings\n            const chosen_pricings = _.find(this.data.pricings, (nb) => nb > 0);\n            if (!chosen_pricings) {\n                return $('.pricings-error')\n                    .html('Veuillez choisir au moins un billet')\n                    .removeClass('d-none');\n            }\n\n            // Add to cart\n            TKTApi.addToCart(\n                this.data.screening._id,\n                this.data.pricings,\n                (err, status, rsp) => {\n                    if (err) {\n                        return $('.pricings-error')\n                            .html(rsp.errorMsg)\n                            .removeClass('d-none');\n                    }\n\n                // Hide forms and show success message\n                $('.dates-form, .tickets-form').addClass('d-none');\n                $('.success-panel').removeClass('d-none');\n\n                // Reload and emit cart update\n                TKTApi.loadCart((err, status, rsp) => {\n                    if (err)\n                        return;\n\n                    this.emit_cart_update(new CartModel(rsp));\n                });\n            });\n        },\n\n        book: function() {\n            if (!this.data.screening._id)\n                return new Error(\"No screening\");\n\n            TKTApi.book(this.data.screening._id, (err, status, rsp) => {\n                if (err) {\n                    $('.book-form-success', this.$container).addClass('d-none');\n                    $('.book-form-error', this.$container)\n                        .html(\"Une erreur est survenue. Veuillez ré-essayer ultérieurement.\")\n                        .removeClass('d-none');\n                } else if (rsp.flash && rsp.flash.error) {\n                    $('.book-form-success', this.$container).addClass('d-none');\n                    $('.book-form-error', this.$container)\n                        .html(rsp.flash.error)\n                        .removeClass('d-none');\n                } else {\n                    $('.book-form-error', this.$container).addClass('d-none');\n                    $('.book-form-success', this.$container)\n                        .html(rsp.flash.success)\n                        .removeClass('d-none');\n                }\n\n                this.check_bookability();\n            });\n        },\n\n        connect_pass: function() {\n            $('.pass-error', this.$container).html(\"\").addClass('d-none');\n\n            if (!this.data.pass_infos.number || !this.data.pass_infos.key)\n                return $('.pass-error')\n                    .html('Veuillez remplir les deux champs')\n                    .removeClass('d-none');\n\n            TKTApi.loginTicket(\n                this.data.pass_infos.number,\n                this.data.pass_infos.key,\n                (err, status, rsp) => {\n                    if (err)\n                        return $('.pass-error')\n                            .html('Les informations que vous avez saisies sont invalides')\n                            .removeClass('d-none');\n\n                    this.data.ticket = new Ticket(rsp);\n                    this.emit_connection_update(this.data.ticket);\n                }\n            );\n        },\n\n        check_bookability: function(callback) {\n            if (!this.data.screening._id)\n                return new Error(\"No screening\");\n\n            TKTApi.checkBookability(this.data.screening._id, (err, status, rsp) => {\n                if (err)\n                    return false;\n\n                this.data.bookability = rsp;\n\n                if (this.data.bookability.ticket_logged_in) {\n                    $('.connect-panel', this.$container).addClass('d-none');\n                    $('.book-panel', this.$container).removeClass('d-none');\n                    $('.show-bookings-btn', this.$container).removeClass('d-none');\n\n                    if (this.data.bookability.ticket_can_book_screening) {\n                        $('.book-btn', this.$container).removeClass('d-none');\n                        $('.book-form-error', this.$container).addClass('d-none');\n                    } else {\n                        $('.book-btn', this.$container).addClass('d-none');\n                        const msg = this.data.bookability.screening_already_booked ?\n                            \"Vous ne pouvez pas réserver plus de place pour cette séance avec votre abonnement.\" :\n                            \"Vous ne pouvez pas réserver de place pour cette séance avec votre abonnement.\";\n                        $('.book-form-error', this.$container)\n                            .html(msg)\n                            .removeClass('d-none');\n                    }\n                } else {\n                    $('.connect-panel', this.$container).removeClass('d-none');\n                    $('.book-panel', this.$container).addClass('d-none');\n                }\n            });\n        },\n\n        build_form: function() {\n            this.$container.html(\"\");\n            this.$dates_form    = $('<div class=\"dates-form\"></div>').appendTo(this.$container);\n            this.$tickets_form  = $('<div class=\"tickets-form\"></div>').appendTo(this.$container);\n            this.$success_panel = $('<div class=\"success-panel d-none\"></div>').appendTo(this.$container);\n\n            this.build_dates_form();\n            this.build_success_panel();\n        },\n\n        build_dates_form: function() {\n            // render template\n            this.$dates_form.html(Template.render('tkt-booking-form-dates-tpl', {\n                screenings: this.data.screenings,\n            }));\n\n            // bind dates choices\n            $('.date-wrapper span.date').click((e) => {\n                const $date = $(e.target);\n                this.select_screening($date.data('screening_id'));\n            });\n\n            // Select first date\n            this.select_screening(this.data.screenings[0]._id);\n        },\n\n        build_tickets_form: function() {\n            // render template\n            this.$tickets_form.html(Template.render('tkt-booking-form-pricings-tpl', {\n                screening: this.data.screening\n            }));\n\n            // bind pricing fields\n            $('.pricing-input', this.$container).change((e) => {\n              const $input = $(e.target);\n              this.data.pricings[$input.data('pricing')] = parseInt($input.val());\n            });\n\n            // bind pass panel toggler\n            $('a.show-connect-panel-form', this.$container).click((e) => {\n                e.preventDefault();\n                $('.connect-panel-form').removeClass('d-none');\n            });\n\n            // bind pass fields\n            $('.pass-number-input,.pass-key-input', this.$container).change((e) => {\n              this.data.pass_infos = {\n                number: $('.pass-number-input', this.$container).val(),\n                key: $('.pass-key-input', this.$container).val()\n              };\n            });\n\n            // bind pass connect button\n            $('.connect-btn', this.$container).click(this.connect_pass.bind(this));\n\n            // bind book button\n            $('.book-btn').click(this.book.bind(this));\n\n            // bind add-to-cart button\n            $('.add-to-cart-btn').click((e) => {\n              this.process_add_to_cart();\n            });\n        },\n\n        build_success_panel: function() {\n            // render template\n            this.$success_panel.html(Template.render('tkt-booking-form-success-tpl', {\n                program_url: config.get('program_url'),\n                cart_url: config.get('cart_url')\n            }));\n        },\n\n        select_screening: function (screening_id) {\n            $('.date-wrapper .date').removeClass('active');\n            $('.date-wrapper .date[data-screening_id=\"' + screening_id + '\"]').addClass('active');\n\n            // reset data\n            this.reset_store_on_screening_change();\n\n            this.data.screening = _.find(this.data.screenings, (s) => s._id === screening_id );\n            this.build_tickets_form();\n\n            this.check_bookability();\n        },\n\n        detach: function() {\n\n        }\n    };\n\n    return Form;\n});\n"]}