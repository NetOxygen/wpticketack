{"version":3,"sources":["app/Pass/BuyForm.js"],"names":["e","a","_typeof","Symbol","iterator","exports","define","amd","moment","this","obj","l","dependencies","BuyForm","$container","$pass","Object","prototype","toString","call","$selected_pass","attach","M","t","length","s","push","init","add_to_cart","$","userdata","h","_this","va","_this2","utc","Y","pricing","_pf","console","TKTApi","addPassToCart","unusedInput","overflow","config","charsLeftOver","location","nullInput","invalidMonth","userInvalidated","iso","parsedDateParts","cart_url","meridiem","show_success","msg","y","fields_to_show","n","isNaN","_d","getTime","empty","invalidWeekday","weekdayMismatch","invalidFormat","$wrappers","alert","_isValid","$field","sync_pass_form","detach","L","each","Array","some","hide","_","w","id","d","momentProperties","required","k","o","_isAMomentObject","_i","_f","_l","_strict","_tzm","_isUTC","_offset","_locale"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Show a pass buy form\n *\n * Usage:\n *\n * <div\n *    <!-- Required -->\n *    data-component=\"Pass/BuyForm\"\n * >\n */\ndefine([\n        'config', 'postal', 'lodash', 'jquery', 'jqueryjson', 'api', 'i18n'\n    ], function dependencies(\n        config, postal, _, $, $json, TKTApi, i18n) {\n\n    function BuyForm($container, state) {\n        this.$container = $container;\n        this.$pass      = $('.pass', this.$container);\n\n        // Ensure $pass is always an array\n        if ('object' === typeof this.$pass)\n            this.$pass = [this.$pass];\n\n        this.$selected_pass = this.$pass[0];\n\n        this.$wrappers = $('.field-wrapper', this.$container);\n        this.$fields   = $('.field-wrapper .field', this.$container);\n    }\n\n    BuyForm.prototype = {\n        attach: function() {\n            this.init();\n        },\n\n        init: function() {\n            if (this.$pass.length == 1)\n                this.sync_pass_form(this.$pass[0].data('type'));\n\n            $('button[type=\"submit\"]', this.$container).click((e) => {\n                e.preventDefault();\n                this.add_to_cart();\n            });\n        },\n\n        add_to_cart: function() {\n            let userdata = $('.field:visible,.opaque_field', this.$container)\n                .filter(function(i) { return !!($(this).val()); })\n                .serializeJSON();\n            console.log(userdata);\n            userdata.no_photo = true;\n\n            this.$selected_pass = $('.choose-pass:checked', this.$container).parents('.pass');\n            let type            = this.$selected_pass.data('type');\n\n            const pricing = $('.choose-pass:checked', this.$container).val();\n            if (!pricing)\n                return this.show_error(i18n.t('Veuillez choisir un tarif'));\n\n            TKTApi.addPassToCart(type, pricing, userdata, (err, status, rsp) => {\n                if (err)\n                    return this.show_error(i18n.t('Une erreur est survenue. Veuillez ré-essayer ultérieurement.'));\n\n                const cart_url = config.get('cart_url');\n                if (cart_url)\n                    window.location.href = cart_url;\n                else\n                    this.show_success(i18n.t('Votre panier a été mis à jour'));\n\n                postal.publish({\n                    channel: \"cart\",\n                    topic: \"reload\"\n                });\n            });\n        },\n\n        show_success(msg) {\n            alert(msg);\n        },\n\n        show_error(msg) {\n            alert(msg);\n        },\n\n        sync_pass_form: function (pass) {\n            let fields_to_show = $('#' + pass + '-fields').val().split(',');\n\n            // Set not required and hide all fields\n            $('.field', this.$container).each(function (i) {\n                $(this).required = false;\n            });\n            this.$wrappers.hide();\n\n            _.each(this.$wrappers, (w) => {\n                // Set required and show requested fields\n                let id     = $(w).attr('id').replace('field-wrapper-', '');\n                let $field = $('#' + id);\n                if (fields_to_show.includes(id)) {\n                    $field.required = true;\n                    $(w).fadeIn();\n                }\n            });\n        },\n\n        detach: function() {\n\n        }\n    };\n\n    return BuyForm;\n});\n"]}