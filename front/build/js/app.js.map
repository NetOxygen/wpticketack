{"version":3,"sources":["app/Booking/ScreeningsList.js"],"names":["e","a","define","ScreeningsList","prototype","ids","postal","parseInt","toString","call","getUrlParam","check_bookability","M","_this","t","s","init_store","subscribe","push","channel","init","TKTApi","hasOwnProperty","L","rsp","h","_this2","valueOf","c","va","screening","Y","_pf","empty","unusedTokens","unusedInput","overflow","pricings","charsLeftOver","pass_infos","nullInput","reset_store_on_screening_change","screenings","emit_cart_update","publish","cart","topic","_d","getTime","data","bookability","emit_connection_update","process_add_to_cart","userInvalidated","n","Array","some","Object","this","length","i18n","d","l","momentProperties","k","_this3","book","p","Date","NaN","isValid","updateOffset","D","_isAMomentObject","T","Math","$","html","g","loginTicket","err","number","_this5","r","_this6","console","warn","deprecationHandler","$container","flash","removeClass","arguments","slice","_this4","build_form","v","build_dates_form","click","$date","_this7","b","s_to_select","i","_id","j","build_tickets_form","suppressDeprecationWarnings","keys","x","P","val","toLowerCase","W","parent","A","_this8","F","preventDefault","max","substr","z","J","N","R","closest","s_id","unselect_screening","apply","G","selected_screening","match","activate_day","day","replace","H","activate_screening","$tickets_form","select_screening","Template","test","lastIndex","U","V","Z","B","q","Q","X","ee","ae","te","se","ne","de","re","_e","ie","deactivate_screening","$qty","$t","screening_id","trigger","$input","m","url","window","name","le","_w","detach","target","he","Le","ce","Ye","ye","De","Te","ge","I","year","build_success_panel","$success_panel","addClass","select_day","$day_input","parseTwoDigitYear","data_screening_id","first_screening","we","Se","be","He","_isUTC","appendTo","date","month","je","show_or_hide_add_to_cart_button","nb","indexOf","chosen_pricings","location","href","regex","results","monthsRegex","_locale","me"],"mappings":"CAAA,SAAAA,EAAAC,GAWAC,iJAXA,oQAoB+C,SAFDC,EAAAA,GAW1CA,YAAAA,IAAeC,EAX2B,SAalCC,EAAAA,GADe,MAGfC,iBAAiBC,GAAA,oBAAAA,OAfiBH,UAAAI,SAAAC,KAAAT,GAAA,SAOEU,EAAAA,GAWFP,OAAAA,aAAAA,MACrBQ,kBAAAA,OAAAA,UAAAA,SAAAA,KAAAA,GAJI,SAAAC,EAAAZ,EAAAa,GAAA,IAAAC,EAAAC,EAHFC,GAGE,IAJEV,EAAAA,EAAAW,EAAAA,EAAAA,SAAAH,EAAAC,EAAAG,KAejBC,EAAAA,EAAAA,GAAAC,IAfiB,OAAAL,EAgBnBM,SAAAA,EAAAA,EAAAA,GAAAA,OAAAA,OAhBmBjB,UAAAkB,eAAAb,KAAAT,EAAAC,GAIF,SAayBsB,EAAAvB,EAAfwB,GAbV,IAIJb,IAAAA,KAAAA,EAe6CS,EAAAnB,EAAAa,KAAAM,EAAAA,GAPDnB,EAAAa,IAAA,OAAAW,EAAAC,EAAAA,cAAA1B,EAAAQ,SAAAP,EAAAO,UAAAiB,EAAAxB,EAAA,aAAAD,EAAA2B,QAAA1B,EAAA0B,SAAA3B,EAAA,SAAA4B,EAAA5B,EASrD0B,EAAAA,EAAAA,GATqD,OAAAG,GAAA7B,EAD5CC,EAAA6B,EAAAA,GAAAA,GAAAA,MAC4C,SAAAC,EAAA/B,GAAA,OAAA,MAAAA,EAAAgC,MAAAhC,EAAAgC,IAAA,CAAAC,OAgBrDH,EAFQI,aAAA,GAAAC,YAd6C,GAAAC,UAiBrDC,EAjBqDC,cAkBrDC,EAlBqDC,WAAA,EAR5C7B,aAAAA,KAqBMK,eA7BA,EAwCvByB,iBAAAA,EAAAA,KACIC,EADJD,gBAAAA,GAAAA,SAGIJ,KAHJI,SAIIF,EAJJE,iBAAAA,IAAAA,EAAAA,IAxCuB,SAQN9B,EAAAA,GA4CjBgC,GAAAA,MAAAA,EAAAA,SAAAA,CACIrC,IAAAA,EAAAA,EAAOsC,GAAAA,EAAAA,EAAPtC,KADuBuC,EAAAA,gBAAAA,SAAAA,GAEnB1B,OAAAA,MADWnB,IAEX8C,GAAAA,MAAAA,EAFWC,GAAAC,YADQH,EAAAA,SAAAA,IAAAA,EAAAA,QAAAA,EAAAA,eAAAA,EAAAA,iBAAAA,EAAAA,kBAAAA,EAAAA,YAAAA,EAAAA,gBAAAA,EAAAA,mBAAAA,EAAAA,UAAAA,EAAAA,UAAAA,GACR,GAAA7C,EAGXiD,UAAMC,EAHKnC,GADQ8B,IAAAA,EAAAA,eAAAA,IAAAA,EAAAA,aAAAA,aAAAA,IAAAA,EAAAA,SAAAA,MAAAA,OAAAA,UAAAA,OAAAA,SAAAA,GA5CVlC,OAAAA,EAsDjBwC,EAAAA,SAAAA,EAAAA,OACmBnD,EACXmB,SAxDSR,SAuDEgC,EAAAA,GADsB,IA9DlBrC,EAAAA,EAAAA,KAAA,OAAA,MAwEvB8C,EAAAA,EAAAA,EAxEuBnD,GAAAD,GAAA+B,EAAA9B,GAAAoD,iBAAA,EAAApD,EAAAqD,EAAAC,MAAAnD,UA0EjByC,KAAAA,MA1EiBzC,UAAAoD,KAAA,SAAAxD,GAAA,IAAAM,IA8DkBL,EAAAwD,OAAAC,MAAA5C,EAAAb,EAAA0D,SAAA,EAAA5C,EAAA,EAAAA,EAAAD,EAAAC,IAtDxBJ,GAAAA,KAAAA,GAAAA,EAAAA,KAAAA,KAAAA,EAAAA,GAAAA,EAAAA,GAsESwC,OAAAA,EAERS,OAFQtD,GANM,IAAAuD,EAAAC,EAAAC,iBAAA,GAAA,SAAAC,EAAAhE,EAiBXiD,GAjBW,IAAAnC,EAQd8C,EAAAA,EAAAA,GAxEDjD,EAAAA,EAAAA,oBAAAA,EAAAA,iBAAAA,EAAAA,kBAAAA,EAAAA,EAAAA,MAAAA,EAAAA,GAAAA,EAAAA,IAAAA,EAAAA,EAAAA,MAAAA,EAAAA,GAAAA,EAAAA,IAAAA,EAAAA,EAAAA,MAAAA,EAAAA,GAAAA,EAAAA,IAAAA,EAAAA,EAAAA,WAAAA,EAAAA,QAAAA,EAAAA,SAAAA,EAAAA,EAAAA,QAAAA,EAAAA,KAAAA,EAAAA,MAAAA,EAAAA,EAAAA,UAAAA,EAAAA,OAAAA,EAAAA,QAAAA,EAAAA,EAAAA,WAAAA,EAAAA,QAAAA,EAAAA,SAAAA,EAAAA,EAAAA,OAAAA,EAAAA,IAAAA,EAAAA,IAAAA,EAAAA,EAAAA,WAAAA,EAAAA,QAAAA,EAAAA,SAAAA,EAAAA,EAAAA,OA6FLyC,IAAAA,EAAAA,EAAAA,EAAAA,EACIO,OAAAP,IAF8Ba,EAAAA,EAAAhE,EAAAc,EAAA8C,EAAA/C,OAAAd,EAAAe,GAAAuC,GAAA,OAAAtD,EAAA,IAAAC,GAS9CiE,EAAiB,SAAAC,EAAAnE,GAAAgE,EAAAN,KAT6B1D,GAAA0D,KAAAX,GAAA,IAAAqB,KAAA,MAAApE,EAAA+C,GAAA/C,EAAA+C,GAAAC,UAAAqB,KAAAX,KAAAY,YAAAZ,KAAAX,GAAA,IAAAqB,KAAAC,OAAA,IAAApE,IAAAA,GAAA,EAAA6D,EAAAS,aAAAb,MAAAzD,GAAA,GAS7B,SAAAuE,EAAAxE,GAAA,OAT6BA,aAAAmE,GAAA,MAAAnE,GAAA,MAAAA,EAAAyE,iBAwB/B,SAAAC,EAAA1E,GACD,OAAAA,EAAA,EACA2E,KAAAC,KAAA5E,IAAA,EAAA2E,KAbiDE,MAAArD,GAWhD,SAAAsD,EAAA9E,GAAA,IAAAC,GAYT2E,EAAA9D,EAAA,EAZS,OAAA,IAmBXO,GAAO0D,SACH9E,KAAA+E,EAAAN,EAAKzB,IAALnC,EAGQkE,SAAAA,EAAAA,EAAAA,EAAAA,GAHaC,IAAAA,EAAAA,EAAAA,KASjBC,IAAK/B,EAAAA,OAAAA,EAAAA,QAAuB+B,EAAAA,KAAKjC,IAAjCiC,EATiBD,OAAAA,EAAAA,QAAAA,EAAAA,EAAAA,IAAAA,EADzB5D,EAnBWN,EAAAuC,EAAAvC,KAVEM,GAd6BrB,EAAAe,KAAAd,EAAAc,KAAAD,GAAAgE,EAAA9E,EAAAe,MAAA+D,EAAA7E,EAAAc,MAAAoE,IAAA,OA5F7BxE,EAAAA,EA0JjBA,SAAAA,EAAAA,IAAAA,IAAsCmD,EAAAsB,6BAAA,oBAAAC,SAAAA,QAAAC,MAAAD,QAAAC,KAAA,wBAAAtF,GAAtCW,SAIIU,EAAAA,EAAAA,GAAkD2D,IAAAA,GAC9C,EAAA,OAAAzD,EAAA,WAAA,GAAA,MAGAuC,EAAAyB,oBAAwB/D,EAJ2CgE,mBAM1DvC,KAAKC,GAAAA,EAAAA,CALd,IAAA,IAOMlD,EAAAwB,EAAAiE,GAAAjE,EAAe4D,EAAAA,EAAKI,UAAYE,OAAAA,IAAAA,CAClCd,GAAE5E,EAAA,GAAA,iBAAsBoF,UAAxBR,GAAAA,CAEA,IAAA,IAAA7D,KAAAf,GAAckD,MAAVsC,EAAAA,KACAZ,UAAEa,GADNzF,GAAAe,EAAA,KAAA4E,UAAA,GAAA5E,GAAA,KAGOf,EAAAA,EAAA4F,MAAA,GAAAhB,QAdmCI,EAAAA,UAAAA,GAuBvCa,EAAA3E,KAEH0D,GAvLKjE,EAAAA,EAAAA,gBAAAA,MAAAA,UAAAA,MAAAA,KAAAA,GAAAA,KAAAA,IAAAA,MAAAA,IAAAA,OAAAA,OAAAA,GAAAA,EA4LLmF,OAAAA,EAAAA,MAAAA,KAAAA,YAAAA,GAGR,IAAA/E,EAAAgF,EAAA,GAHQD,SAUZE,EAAAA,EAAAA,GAO8BC,MAClBC,EAAAA,oBAAAA,EAAAA,mBAAAA,EAAAA,GAAAA,EAAAA,KAAAA,EAAAA,GAAAA,EAAAA,IAAAA,GADkBD,SAAAA,EAAAA,GAAAA,OAAAA,aAOlBE,UAAAA,sBAAAA,OAPkBF,UAAAA,SAAAA,KAAAA,GAPD,SAAAG,EAAApG,EAAAC,GAOCgG,IAAAA,EAjBlBH,EAAAA,EAAAA,GAAAA,GAAAA,IA5LKnF,KAAAA,EA8NLA,EAAAA,EAAAA,KAAAA,EAAAA,EACI0F,KAAAA,EAAAA,EAAAA,KAAAA,EAAAA,GAAAA,GAAAA,EAAAA,EAAAA,GAAmBpD,EAAAA,IAAAA,EAAAA,EAAAA,GAAAA,EAAAA,KAAAA,MAAAA,EAAAA,GAAAA,EAAAA,GAAAA,EAAAA,UAAAA,EAAAA,IAAAA,IAAAA,KAAAA,EAFZxB,EAAAzB,EAAAc,KAGXwF,EAHWrG,EAAA6B,IAAAA,EAAA9B,EAAAc,MAAAmC,EAAAA,GAAAnB,EAAAA,GAAAf,EAAAwF,KAAA,OAAAxF,EAvBM,SAAAyF,EAAAxG,GA9MN,MAAAA,GA+OvByG,KAAAA,IAAAA,GAjC6B3C,EAAA4C,6BAuCNxD,EAAAA,EAAAA,mBADmD,KAAAnC,EAAA0C,OAAAkD,KAAAlD,OAAAkD,KAAA,SAAA3G,GAAA,IAAAC,EAAAa,EAAA,GAAA,IAAAb,KAAAD,EAAAyB,EAAAzB,EAAAC,IAMpEa,EAAAI,KAAAjB,GANoE,OAAAa,GAMpB,IAAA8F,EAAA,GAAA,SAAAC,EAAA7G,EAAAC,GAKnC6G,IAAAA,EAAAA,EAAAA,cAAAA,EAAAA,GAAAA,EAAAA,EAAAA,KAEGA,EAAAA,GAAM1B,EAFT0B,SAAAA,EAAAA,GAXuD,MAAA,iBAL3C9G,EAAA4G,EAAA5G,IAAA4G,EAAA5G,EAAA+G,oBAAA,EAAA,SAAAC,EAAAhH,GAAA,IAAAC,EAAAa,EAjCFC,EAAA,GAAA,IA8BzBM,KAL+B4B,EA/NlBtC,EAAAA,EAAAA,KAAAA,EAAAA,EAAAA,MAAAA,EAAAA,GAAAA,EAAAA,IAmQoCmF,OAAAA,EAM7BmB,IAAAA,EAN6B,GAM7BA,SAN6BC,EAAAlH,EAY7CmH,GANgBF,EAAAA,GAN6BhH,EAM7BgH,SAS+BG,EAAApH,EAEjDmH,EAAAA,GAXkBF,IAzQPtG,EAAAA,GAAAA,KAAAA,IAAAA,GAAAA,EAAAA,EAAAA,EAAAA,OAwRgDqF,OAAAA,GAAAA,EAAAA,EACvDqB,IAAAA,GAAAA,KAAAA,KAAAA,IADuD,GAAA1C,KAAA2C,IAAA,EAAAhE,IAAA9C,WAAA+G,OAAA,GAAAxG,EAAA,IAAAyG,EAAA,uLAAAC,EAAA,6CAAAC,EAAA,GAAAC,EAAA,GAAA,SAOpC/C,EAAA5E,EAAAC,EAAAa,EAAAC,GAD8C,IAAAuC,EAvD5CvC,EAuD4C,iBAAAA,IAAAuC,EAAA,WAAA,OAQrEI,KAAAwC,OAAAlG,IAAA2H,EAGAzB,GAAAA,GAAaD,IAAM2B,EAAAA,EAAAA,IAAA,WAXkD,OAerER,EAAAS,EAAAA,MAAA3B,KAAoBD,WAAMhG,EAAA,GAA1BA,EAfqE,MAAAa,IAgBrEqG,EAAAA,GAAAA,WAAAA,OAAAA,KAvEyBhB,aAAA2B,QAAAxE,EAAAyE,MAuEzBZ,KAAAA,WAAAA,KAhBqE,SAC9CvC,EAPoC5E,EAAAC,GAAA,OA4BuBD,EAFxDqG,WAAApG,EAAA+H,EAAAC,EAAAA,EAAAA,cA1BiCP,EAAAzH,GAAAyH,EAAAzH,IAAA,SAAAc,GAhS1C,IAAAf,EAAAqG,EAAAA,EAAAA,EAAAtF,EAAAmH,MAAAV,GAAA,IAkUvBW,EAAAA,EAAc7E,EAAAO,EAAAZ,OAAAkF,EAAAA,EAAUC,IAClBT,EAAA9D,EAAA7D,IAAAsG,EAAAtG,GAAA2H,EAAA9D,EAAA7D,IAAA6D,EAAA7D,IAAAC,EAAA4D,EAAA7D,IAAAkI,MAAA,YAAAjI,EAAAoI,QAAA,WAAA,IAAApI,EAAAoI,QAAA,MAAA,IAAA,OAAA,SACApF,GAAA,IAAAhD,EAAAa,EApUiBuF,GAmUjB,IAOMC,EAPN,EAAArG,EAAAqD,EAAArD,IAnUiBa,GAAAwH,EAAAzE,EAAA5D,IAAA4D,EAAA5D,GAAAQ,KAAAT,EAAAe,GAAA8C,EAAA5D,GAgS0C,OAAAa,GAAA,CAxRhDH,GAAAA,EAAAA,GAAAA,IAAAA,EAAAA,aAAAA,cAkUU,SAAAqH,EAAAhI,EAAAmH,GAAA,IAW3BoB,EAAAA,EAX2B,SAYrBC,EAAAA,GAtViB,OA0VvBC,EAAAA,eAAkBzI,IAAAyI,EA1VK,IAAAC,EAsVnB9D,UAZuB,EAAA,GAAA9D,GAAA2G,EAAAkB,KAAA3I,IAsB4B4E,EAAnD5E,EAAAqI,QAAAZ,EAAA1G,GANsC0G,EAAAmB,UAMahE,EANbqB,GAAA,EAAA,OAAAjG,EAAA,IAAA6I,EAAA,KAYtCC,EAAKnI,OAAAA,EAAAA,QAZiCmG,EAYjCnG,QAZiCoI,EAAA,aAAAC,EAAA,QAAAC,EAAA,YAAAC,EAAA,gBAAAC,EAAA,UAAAC,GAAA,UAAAC,GAAA,eAAAC,GAAA,MAAAC,GAAA,WAAAC,GAAA,qBAAAC,GAAA,0BAAAC,GAAA,wJAAAC,GAAA,GAAA,SAAAC,GA1VnB5J,EAAAc,EAAAgG,GAAA6C,GAAA3J,GAAAsI,EAAAxH,GAyWvB+I,EAAAA,SAAsB7J,EAAA6J,GAzWC,OAAA7J,GA0WjB8J,EAAAA,EAAAC,GAhBoC,SAManF,GAtB5B5E,GAAA,OA2C3B8H,EAAAA,QAAAA,yBAAoBA,QAAUkC,IAAAA,GAAAA,GAAAA,SAAAA,GAM1BhK,EAAAc,GAN0BkJ,IAAAA,EAAAA,EAO1BlJ,EAP0BkJ,IAAAA,iBArXPlD,IAAAmD,EAAAA,CAAAC,IAAAC,EAAArJ,KAqXOkJ,EAAAA,SAAAA,EAAAA,GAU9BtJ,EAAAA,GA/XuBoJ,EAAAA,KAgYbM,EAAAA,EAAAA,EAAMC,EAAAA,OAXcL,IAAAA,GAAAA,EAY1BM,IAAAA,EAZ0BN,SAA9BlC,GA3C2B9H,EAAAsD,GAAAiH,GAAAvK,EA1UJ,SAAAA,EAAAC,EAAA2E,EAAA7D,GAAAD,EAAA0J,GAyYvBC,EAAQP,IAAAA,GAAAlK,EAAA0K,EAAAA,EAAAA,GAzYe5J,EAAAC,KA0UI,IAAA4J,GA1CvB/F,EAAEgG,GAAA,EAAAC,GAAA,EAAAC,GAAA,EAAAC,GAA6B,EAAKvF,GAAAA,EAAAA,GAAYS,EAAAA,GAAM,EAAA+E,GAAA,EAAO,SAAAC,GACzDjL,GADyD,OAAAkL,GAEvDlL,GAAA,IAAA,IAwCiB,SApCvB4E,GAAE5E,GAAqE,OAAAA,EACrEmH,GAAKlE,GAAKV,EAAAA,KAAV,GAAuBvC,EAAA,KAAA,EAAAmL,EAAA,IAAA,EAAA,EAAA,WAAA,IAAAnL,EAAA0D,KAD8C0H,OAAA,OAoChDpL,GAAA,KAAA,GAAAA,EAAA,IAAAA,IAAAmL,EAAA,EA5BvBvG,CA4BuB,KAAA,GAAA,EAAA,WArBY,OAAAlB,KACjCyD,OAAK/D,MAD4B+H,EAAA,EAAnCvG,CAqBuB,OAhB3ByG,GAAgC,EAAA,QAEvBC,EAAAA,EAAAA,CAA+E,QAAA,GAAA,EAAA,QAFxDH,EAAA,EAAA,CAAA,SAQhChD,GAA6B,GAAA,EAAA,QAEvBtB,EAAA,OAAA,KAAAK,EAAA,OAAA,GAAmCkB,GAAnC,IAAyCmB,IAAMgC,GAAAA,KAASvC,EAAAF,GAA1DlE,GAFyB,OAAAwE,GAAAxE,GAAAgF,GAAA,QAAAP,GAAAN,GAAAa,GAAA,SAAAP,GAAAN,GAAAwB,GAAA,CAAA,QAQ7BiB,UAA2Bb,IACvBJ,GAAA,OAAKpC,SAALnI,EADuBC,GAAAA,EAAA0K,IAGjBc,IAAAA,EAAAA,OAAe3H,EAAA4H,kBAAA1L,GAAA8E,EAAA9E,KAHEuK,GAAA,KAIjBoB,SAAAA,EAAAA,GAJiB1L,EAAA0K,IAKnBgB,EAAAA,kBAAmB3L,KAAAuK,GAAA,IACnB,SAAMqB,EAAAA,GADa3L,EAAA0K,IAEnBpK,SAAKkI,EAAAA,MAFc3E,EAAA4H,kBALA,SAAA1L,GAAA,OAlUVW,EAAAA,IAAAA,GAAAA,EAAAA,GAAAA,KAAAA,MA6U2B,IAAAkL,GACxCjH,GAAEkH,GAAA,YAAA,GADsC,SAExClH,GAAE3E,EAAAa,GAFsC,OA7U3BH,SAAAA,GAkVjB8H,OAAAA,MAAkBzI,GAAA+L,GAAAtD,KAAAA,EAAAA,GAAAA,EAAAA,aAAUuB,KAAclJ,GAAA4C,MAAAsI,GAAAtI,KAAAzD,IAAA,SAMtC+L,GAAAhM,EAAKiD,GAA8C,OAAAjD,EAAAsE,UAAOvD,EAAAA,GAAUiJ,OAAAA,EAAjBiC,OAAA,MAAA,IAAAhM,KAAAoE,IANb,SAOtC0H,GAAA/L,EAAKyG,EAAAA,GAPiCzG,EAAAsE,YAQjCkE,MAAL1H,KACKoL,aAAWjM,GAAAiL,GAAAlL,EAAAoL,SAA8BpB,IAAAA,EAAAA,SAAhCpF,KAAAA,EADduH,OAAAnM,EARsC+C,GAAA,OAAA/C,EAAAiM,OAAA,MAAA,IAAAhM,GAAAa,EAAAd,EAAAoM,QAAAC,GAAAvL,EAAAd,EAAAoM,UAAApM,EAAA+C,GAAA,OAAA/C,EAAAiM,OAAA,MAAA,IAAAhM,GAAAa,IAAA,SAlVzBH,GAAAA,EAAAA,GAiWjBkJ,GAAAA,MAAAA,IAAAA,MAAsB5J,GAClB2E,OAAEP,IAD4B,IAjWjB1D,GAAAA,EAAAA,GAAAA,IAAAA,GAqWjB2L,OAAAA,IAAAA,EAAAA,GAAAA,GAAAA,IAAAA,EAAiCpB,GAAAlL,GAAAsM,GAAAA,GAAAA,GAAAA,EAAAA,EAAAA,EACsBT,GAAAtI,MAAAnD,UAAQmM,QAARhJ,MAAAnD,UAAAoM,QAAA,SAAAxM,GAAA,IAAAC,EADX,IAExCA,EAAIwM,EAAAA,EAAAA,KAAAA,SAAJxM,EAAA,GACI2E,KAAE3E,KAAAD,EADN,OAAAC,EAAA,OAGI2E,GALoCuG,EArW3BxK,IAAAA,CA6WjBmH,KAA4C,GAAA,KAIxC,WAJwC,OAMxCpE,KAAKT,QAAKnB,IAN8BqJ,EAAA,MAOnC3C,EAAAA,EAAAA,SAAc3D,GAPqB,OA7W3BlE,KAAAA,aAAAA,YAAAA,KAAAA,KAuXjBD,EAAAA,OAAAA,EAvXiBC,EAAAA,SAAAA,GAuXC,OACd+C,KAAM0G,aAAasC,OAASC,KADd3M,KAAA6G,EAAA,QAEPyD,KAAKjC,EAAAA,QAAQ,GAAAuB,GAAW,IAAAZ,GAFjBY,GAAA,KAAAZ,EAAAF,GAAAc,GAAA,MAAA,SAAA5J,EAAAC,GAAA,OAGdA,EAAI2M,iBAAQ5M,KAHE4J,GAAA,OAKTiD,SAAL7M,EAAAC,GAAA,OAAAA,EAAc6M,YALA9M,KAAAuK,GAAA,CAMd,IANc,MAAA,SAvXD5J,EAAAA,GAiYjB8J,EAAAA,IAAQ3F,EAAA9E,GAAA,IAAWuK,GAjYF5J,CAZuBD,MAkZ5C,QAhaJR,SAAAA,EAAAA,EAAAA,EAAAA,8gXAgYkBuM,IAAAA,IAAAA,EAAAA,GAA6C1C,GAAQwC,GAAAA,GAAAA,EAARxC,QAAA9J,EAAA8M,SAAAxB,IAAAA,OAAAyB,GAAAhN,EAAAqI,QAA7CoE,KAAAA,IAAAA,QAAAA,sCAAAA,SAAAA,EAAAA,EAAAA,EAAAA,EAAAA,GAAAA,OAAAA,GAAAA,GAAAA,GAAAA,0pBAAAA,EAAAA","file":"app.js","sourcesContent":["/**\n * Show a list of screenings and pricings\n *\n * Usage:\n *\n * <div\n *    <!-- Required -->\n *    data-component=\"Booking/ScreeningsList\"\n *    data-ids=\"12345678-1234-1234-1234-123456789012,...\"\n * >\n */\ndefine( [\n        'config', 'i18n', 'postal', 'lodash',\n        'template', 'jquery', 'api',\n        'moment', 'Cart', 'Screening', 'Ticket'\n    ], function dependencies(\n        config, i18n, postal, _,\n        Template, $, TKTApi,\n        moment, CartModel, Screening, Ticket) {\n\n    function ScreeningsList($container, state) {\n        this.$container  = $container;\n        this.initialized = false;\n\n        this.ids                = this.$container.data('ids').split(',');\n        this.show_on_load       = parseInt(this.getUrlParam('book')) == 1;\n        this.selected_screening = this.getUrlParam('s_id');\n    }\n\n    ScreeningsList.prototype = {\n        attach: function() {\n            this.init_store();\n\n            postal.subscribe({\n                channel: \"connection\",\n                topic: \"update\",\n                callback: (data, envelope) => {\n                    this.check_bookability();\n                }\n            });\n\n            this.init();\n        },\n\n        init: function() {\n            TKTApi.getScreeningsInfo(this.ids, (err, status, rsp) => {\n                this.data.screenings = rsp.map((s) => {\n                    let screening = new Screening(s);\n                    screening.eligible_types = s.eligible_types;\n\n                    return screening;\n                });\n                this.data.screenings = _.sortBy(this.data.screenings, (s) => s.start_at);\n                this.build_form();\n                this.initialized = true;\n            });\n        },\n\n        init_store: function() {\n            this.data = {\n                screenings: [], // current screenings\n                screening: {},  // selected screening\n                pricings: [],   // selected screening pricings\n                pass_infos: {}, // connection infos\n                ticket: {},     // active ticket\n                bookability: {} //selected screening bookability with  active ticket\n            };\n        },\n\n        reset_store_on_screening_change: function() {\n            this.data.screening   = {};\n            this.data.pricings    = {};\n            this.data.pass_infos  = {};\n            this.data.bookability = {};\n        },\n\n        deinit: function() {\n            this.$container.html(\"\");\n            this.initialized = false;\n        },\n\n        emit_cart_update: function(cart) {\n            postal.publish({\n                channel: \"cart\",\n                topic: \"update\",\n                data: {\n                    cart: cart\n                }\n            });\n        },\n\n        emit_connection_update: function(ticket) {\n            postal.publish({\n                channel: \"connection\",\n                topic: \"update\",\n                data: {\n                    ticket: ticket\n                }\n            });\n        },\n\n        process_add_to_cart: function() {\n            $('.pricings-error').html(\"\").addClass('d-none');\n            $('.success-panel').addClass('d-none');\n\n            // Check chosen pricings\n            const chosen_pricings = _.find(this.data.pricings, (nb) => nb > 0);\n            if (!chosen_pricings) {\n                return $('.pricings-error')\n                    .html(i18n.t('Veuillez choisir au moins un billet'))\n                    .removeClass('d-none');\n            }\n\n            // Add to cart\n            TKTApi.addToCart(\n                this.data.screening._id,\n                this.data.pricings,\n                (err, status, rsp) => {\n                    if (err) {\n                        return $('.pricings-error')\n                            .html(rsp.errorMsg)\n                            .removeClass('d-none');\n                    }\n\n                // Hide forms and show success message\n                $('.dates-form, .tickets-form').addClass('d-none');\n                $('.success-panel').removeClass('d-none');\n\n                // Reload and emit cart update\n                TKTApi.loadCart((err, status, rsp) => {\n                    if (err)\n                        return;\n\n                    this.emit_cart_update(new CartModel(rsp));\n                });\n            });\n        },\n\n        book: function() {\n            if (!this.data.screening._id)\n                return new Error(\"No screening\");\n\n            TKTApi.book(this.data.screening._id, (err, status, rsp) => {\n                if (err) {\n                    $('.book-form-success', this.$container).addClass('d-none');\n                    $('.book-form-error', this.$container)\n                        .html(i18n.t(\"Une erreur est survenue. Veuillez ré-essayer ultérieurement.\"))\n                        .removeClass('d-none');\n                } else if (rsp.flash && rsp.flash.error) {\n                    $('.book-form-success', this.$container).addClass('d-none');\n                    $('.book-form-error', this.$container)\n                        .html(rsp.flash.error)\n                        .removeClass('d-none');\n                } else {\n                    $('.book-form-error', this.$container).addClass('d-none');\n                    $('.book-form-success', this.$container)\n                        .html(rsp.flash.success)\n                        .removeClass('d-none');\n                }\n\n                this.check_bookability();\n            });\n        },\n\n        connect_pass: function() {\n            $('.pass-error', this.$container).html(\"\").addClass('d-none');\n\n            if (!this.data.pass_infos.number || !this.data.pass_infos.key)\n                return $('.pass-error')\n                    .html(i18n.t('Veuillez remplir les deux champs'))\n                    .removeClass('d-none');\n\n            TKTApi.loginTicket(\n                this.data.pass_infos.number,\n                this.data.pass_infos.key,\n                (err, status, rsp) => {\n                    if (err)\n                        return $('.pass-error')\n                            .html(i18n.t('Les informations que vous avez saisies sont invalides'))\n                            .removeClass('d-none');\n\n                    this.data.ticket = new Ticket(rsp);\n                    this.emit_connection_update(this.data.ticket);\n\n                    // Redirect to ticket activation if needed\n                    if (this.data.ticket.status == \"new\")\n                        window.location.href =  TKTApi.getTicketViewUrl();\n                }\n            );\n        },\n\n        check_bookability: function(callback) {\n            if (!this.data.screening || !this.data.screening._id)\n                return new Error(\"No screening\");\n\n            TKTApi.checkBookability(this.data.screening._id, (err, status, rsp) => {\n                if (err)\n                    return false;\n\n                this.data.bookability = rsp;\n\n                if (this.data.bookability.ticket_logged_in) {\n                    $('.connect-panel', this.$container).addClass('d-none');\n                    $('.book-panel', this.$container).removeClass('d-none');\n                    $('.show-bookings-btn', this.$container).removeClass('d-none');\n\n                    if (this.data.bookability.ticket_can_book_screening) {\n                        $('.book-btn', this.$container).removeClass('d-none');\n                        $('.book-form-error', this.$container).addClass('d-none');\n                    } else {\n                        $('.book-btn', this.$container).addClass('d-none');\n                        const msg = this.data.bookability.screening_already_booked ?\n                            i18n.t(\"Vous ne pouvez pas réserver plus de place pour cette séance avec votre pass.\") :\n                            i18n.t(\"Vous ne pouvez pas réserver de place pour cette séance avec votre pass.\");\n                        $('.book-form-error', this.$container)\n                            .html(msg)\n                            .removeClass('d-none');\n                    }\n                } else {\n                    $('.connect-panel', this.$container).removeClass('d-none');\n                    $('.book-panel', this.$container).addClass('d-none');\n                }\n            });\n        },\n\n        build_form: function() {\n            this.$container.html(\"\");\n            this.$dates_form    = $('<div class=\"dates-form\"></div>').appendTo(this.$container);\n            this.$tickets_form  = $('<div class=\"tickets-form\"></div>').appendTo(this.$container);\n            this.$success_panel = $('<div class=\"success-panel d-none\"></div>').appendTo(this.$container);\n\n            this.build_dates_form();\n            this.build_success_panel();\n        },\n\n        build_dates_form: function() {\n            // render template\n            this.$dates_form.html(Template.render('tkt-booking-screenings-list-dates-tpl', {\n                screenings: this.data.screenings,\n            }));\n\n            // bind dates choices\n            $('.dates-wrapper .date').click((e) => {\n                let $date = $(e.target);;\n                if (!$date.data('screening_id'))\n                    $date = $date.closest('[data-screening_id]');\n\n                const s_id = $date.data('screening_id');\n                if (this.data.screening && this.data.screening._id == s_id)\n                    this.unselect_screening();\n                else\n                    this.select_screening($date.data('screening_id'));\n            });\n\n            // Select first non full date\n            let s_to_select = this.selected_screening;\n            if (!s_to_select) {\n                let i = this.data.screenings.length - 1;\n                while (i >= 0) {\n                    if (this.data.screenings[i].seats.available > 0)\n                        s_to_select = this.data.screenings[i]._id;\n                    i--;\n                }\n            }\n\n            this.show_on_load && this.select_screening(s_to_select);\n        },\n\n        build_tickets_form: function() {\n            // render template\n            const ticket_view_url = TKTApi.getTicketViewUrl();\n            this.$tickets_form\n                .hide()\n                .html(Template.render('tkt-booking-screenings-list-pricings-tpl', {\n                    screening: this.data.screening,\n                    ticket_view_url\n                }));\n\n            // bind pricings minus buttons if any\n            $('.tkt-minus-btn', this.$container).click((e) => {\n                const $t     = $(e.target);\n                const $input = $t.parent().next('.pricing-input').eq(0);\n                const val    = parseInt($input.val());\n                if (val > 0) {\n                    $input.val(val - 1).trigger('change');\n                    const $qty = $t.parent().find('.pricing-qty').eq(0);\n                    $qty.text(val - 1);\n                }\n                if (val > 1)\n                    $t.removeClass('tkt-grey-badge').addClass('tkt-dark-badge');\n                else\n                    $t.removeClass('tkt-dark-badge').addClass('tkt-grey-badge');\n\n                this.show_or_hide_add_to_cart_button();\n            });\n            // bind pricings plus buttons if any\n            $('.tkt-plus-btn', this.$container).click((e) => {\n                console.log('clicked on plus btn');\n                const $t     = $(e.target);\n                const $input = $t.parent().next('.pricing-input').eq(0);\n                const val    = parseInt($input.val());\n                $input.val(val + 1).trigger('change');\n                const $qty = $t.parent().find('.pricing-qty').eq(0);\n                $qty.text(val + 1);\n                $('.tkt-minus-btn', $t.parent())\n                    .removeClass('tkt-grey-badge')\n                    .addClass('tkt-dark-badge');\n\n                this.show_or_hide_add_to_cart_button();\n            });\n            // bind pricing fields\n            $('.pricing-input', this.$container).change((e) => {\n              const $input = $(e.target);\n              this.data.pricings[$input.data('pricing')] = parseInt($input.val());\n            });\n\n            // bind pass panel toggler\n            $('a.show-connect-panel-form', this.$container).click((e) => {\n                e.preventDefault();\n                $('.connect-panel-form').removeClass('d-none');\n            });\n\n            // bind pass fields\n            $('.pass-number-input,.pass-key-input', this.$container).change((e) => {\n              this.data.pass_infos = {\n                number: $('.pass-number-input', this.$container).val(),\n                key: $('.pass-key-input', this.$container).val()\n              };\n            });\n\n            // bind pass connect button\n            $('.connect-btn', this.$container).click(this.connect_pass.bind(this));\n\n            // bind book button\n            $('.book-btn').click(this.book.bind(this));\n\n            // bind add-to-cart button\n            $('.add-to-cart-btn').hide();\n            $('.add-to-cart-btn').click((e) => {\n              this.process_add_to_cart();\n            });\n        },\n\n        build_success_panel: function() {\n            // render template\n            this.$success_panel.html(Template.render('tkt-booking-screenings-list-success-tpl', {\n                program_url: config.get('program_url'),\n                cart_url: config.get('cart_url')\n            }));\n        },\n\n        activate_day: function (day) {\n            $('.days-wrapper .day').removeClass('active');\n            $('.days-wrapper .day[data-day*=\"' + day + '\"]').addClass('active');\n\n            //$('.dates-wrapper .date').hide();\n            //$('.dates-wrapper .date[data-day=\"' + day + '\"]').show();\n        },\n\n        select_day: function (day) {\n            this.activate_day(day);\n\n            const $day_input = $('.days-wrapper .day[data-day*=\"' + day + '\"]');\n            const data_screening_id = $day_input.data('screening_id');\n            if (data_screening_id) {\n                const first_screening = data_screening_id.split(',')[0];\n                this.select_screening(first_screening);\n            }\n        },\n\n        activate_screening: function (screening_id) {\n            $('.dates-wrapper .date').removeClass('active');\n            $('.dates-wrapper .date[data-screening_id=\"' + screening_id + '\"]').addClass('active');\n        },\n\n        select_screening: function (screening_id) {\n            this.activate_screening(screening_id);\n\n            // reset data\n            this.reset_store_on_screening_change();\n\n            this.data.screening = _.find(this.data.screenings, (s) => s._id === screening_id );\n            this.build_tickets_form();\n            this.$tickets_form\n                .appendTo($('.date[data-screening_id=\"' + screening_id + '\"]').parent())\n                .fadeIn();\n\n            this.check_bookability();\n        },\n\n        deactivate_screening: function () {\n            $('.dates-wrapper .date').removeClass('active');\n        },\n\n        show_or_hide_add_to_cart_button: function() {\n            const chosen_pricings = _.find(this.data.pricings, (nb) => nb > 0);\n            if (chosen_pricings > 0)\n                $('.add-to-cart-btn').css({'display': 'block'});\n            else\n                $('.add-to-cart-btn').hide();\n        },\n\n        unselect_screening: function (screening_id) {\n            this.deactivate_screening();\n\n            // reset data\n            this.reset_store_on_screening_change();\n\n            this.data.screening = null;\n            this.$tickets_form.html(\"\");\n        },\n\n        getUrlParam(name) {\n            const url = window.location.href;\n            name = name.replace(/[\\[\\]]/g, '\\\\$&');\n            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n                results = regex.exec(url);\n            if (!results) return null;\n            if (!results[2]) return '';\n            return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n        },\n\n        detach: function() {\n\n        }\n    };\n\n    return ScreeningsList;\n});\n"]}