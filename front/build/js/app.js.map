{"version":3,"sources":["app/Pass/BuyForm.js"],"names":["e","a","_typeof","Symbol","iterator","exports","define","amd","moment","this","obj","l","$container","$pass","m","Object","prototype","toString","call","$wrappers","$fields","Date","BuyForm","attach","sync_pass_form","$","init","h","data","L","_","_this","name","t","c","_this2","s","va","userdata","$selected_pass","utc","Y","show_error","empty","err","unusedInput","pricing","overflow","charsLeftOver","cart_url","nullInput","invalidMonth","TKTApi","postal","userInvalidated","iso","parsedDateParts","meridiem","rfc2822","show_success","weekdayMismatch","_pf","y","fields","n","msg","unusedTokens","length","bigHour","isFrozen","detach","each","w","Array","includes","field","some","d"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Show a pass buy form\n *\n * Usage:\n *\n * <div\n *    <!-- Required -->\n *    data-component=\"Pass/BuyForm\"\n * >\n */\ndefine([\n        'config', 'postal', 'lodash', 'jquery', 'api', 'i18n'\n    ], function dependencies(\n        config, postal, _, $, TKTApi, i18n) {\n\n    function BuyForm($container, state) {\n        this.$container = $container;\n        this.$pass      = $('.pass', this.$container);\n\n        // Ensure $pass is always an array\n        if ('object' === typeof this.$pass)\n            this.$pass = [this.$pass];\n\n        this.$selected_pass = this.$pass[0];\n\n        this.$wrappers = $('.field-wrapper', this.$container);\n        this.$fields   = $('.field-wrapper .field', this.$container);\n    }\n\n    BuyForm.prototype = {\n        attach: function() {\n            this.init();\n        },\n\n        init: function() {\n            if (this.$pass.length == 1)\n                this.sync_pass_form(this.$pass[0].data('type'));\n\n            $('button[type=\"submit\"]', this.$container).click((e) => {\n                e.preventDefault();\n                this.add_to_cart();\n            });\n        },\n\n        add_to_cart: function() {\n            let userdata = {};\n            _.each($('.field:visible', this.$container), (f) => {\n                let name = $(f).attr('id').replace('user_', '');\n                userdata[name] = $(f).val();\n            });\n            userdata.no_photo = true;\n            const pricing = $('.choose-pass:checked', this.$container).val();\n            this.$selected_pass = $('.choose-pass:checked', this.$container).parents('.pass');\n            let type = this.$selected_pass.data('type');\n            if (!pricing)\n                return this.show_error(i18n.t('Veuillez choisir un tarif'));\n\n            TKTApi.addPassToCart(type, pricing, userdata, (err, status, rsp) => {\n                if (err)\n                    return this.show_error(i18n.t('Une erreur est survenue. Veuillez ré-essayer ultérieurement.'));\n\n                const cart_url = config.get('cart_url');\n                if (cart_url)\n                    window.location.href = cart_url;\n                else\n                    this.show_success(i18n.t('Votre panier a été mis à jour'));\n\n\n                postal.publish({\n                    channel: \"cart\",\n                    topic: \"reload\"\n                });\n            });\n        },\n\n        show_success(msg) {\n            alert(msg);\n        },\n\n        show_error(msg) {\n            alert(msg);\n        },\n\n        sync_pass_form: function (pass) {\n            let fields = $('#' + pass + '-fields').val().split(',');\n            _.each(this.$wrappers, (w) => {\n                let field = $(w).attr('id').replace('field-wrapper-', '');\n                $(w)[fields.includes(field) ? 'fadeIn' : 'hide']();\n            });\n        },\n\n        detach: function() {\n\n        }\n    };\n\n    return BuyForm;\n});\n"]}