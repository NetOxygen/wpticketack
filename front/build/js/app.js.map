{"version":3,"sources":["app/Pass/BuyForm.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","define","dependencies","config","postal","_","Template","$","TKTApi","moment","CartModel","Screening","Ticket","BuyForm","$container","state","$pass","$selected_pass","$wrappers","$fields","attach","init","_this","length","sync_pass_form","data","click","e","preventDefault","add_to_cart","_this2","type","userdata","each","f","name","attr","replace","val","no_photo","pricing","show_error","addPassToCart","err","status","rsp","show_success","publish","channel","topic","msg","alert","pass","fields","split","w","field","includes","detach"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Show a pass buy form\n *\n * Usage:\n *\n * <div\n *    <!-- Required -->\n *    data-component=\"Pass/BuyForm\"\n * >\n */\ndefine( [\n        'config', 'postal', 'lodash',\n        'template', 'jquery', 'api',\n        'moment', 'Cart', 'Screening', 'Ticket'\n    ], function dependencies(\n        config, postal, _,\n        Template, $, TKTApi,\n        moment, CartModel, Screening, Ticket) {\n\n    function BuyForm($container, state) {\n        this.$container = $container;\n        this.$pass      = $('.pass', this.$container);\n\n        // Ensure $pass is always an array\n        if ('object' === typeof this.$pass)\n            this.$pass = [this.$pass];\n\n        this.$selected_pass = this.$pass[0];\n\n        this.$wrappers = $('.field-wrapper', this.$container);\n        this.$fields   = $('.field-wrapper .field', this.$container);\n    }\n\n    BuyForm.prototype = {\n        attach: function() {\n            this.init();\n        },\n\n        init: function() {\n            if (this.$pass.length == 1)\n                this.sync_pass_form(this.$pass[0].data('type'));\n\n            $('button[type=\"submit\"]', this.$container).click((e) => {\n                e.preventDefault();\n                this.add_to_cart();\n            });\n        },\n\n        add_to_cart: function() {\n            let type = this.$selected_pass.data('type');\n            let userdata = {};\n            _.each($('.field:visible', this.$container), (f) => {\n                let name = $(f).attr('id').replace('user_', '');\n                userdata[name] = $(f).val();\n            });\n            userdata.no_photo = true;\n            const pricing = $('.choose-pass:checked', this.$selected_pass).val();\n            if (!pricing)\n                return this.show_error('Veuillez choisir un tarif');\n            TKTApi.addPassToCart(type, pricing, userdata, (err, status, rsp) => {\n                if (err)\n                    return this.show_error('Une erreur est survenue');\n\n                this.show_success(\"L'abonnement a été ajouté à votre panier\");\n\n                postal.publish({\n                    channel: \"cart\",\n                    topic: \"reload\"\n                });\n            });\n        },\n\n        show_success(msg) {\n            alert(msg);\n        },\n\n        show_error(msg) {\n            alert(msg);\n        },\n\n        sync_pass_form: function (pass) {\n            let fields = $('#' + pass + '-fields').val().split(',');\n            _.each(this.$wrappers, (w) => {\n                let field = $(w).attr('id').replace('field-wrapper-', '');\n                $(w)[fields.includes(field) ? 'fadeIn' : 'hide']();\n            });\n        },\n\n        detach: function() {\n\n        }\n    };\n\n    return BuyForm;\n});\n"]}