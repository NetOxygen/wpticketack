{"version":3,"sources":["app/Pass/BuyForm.js"],"names":["e","a","_typeof","Symbol","iterator","exports","define","amd","moment","this","obj","l","dependencies","BuyForm","$container","$pass","Object","prototype","toString","call","$selected_pass","attach","M","t","length","s","push","init","add_to_cart","$","userdata","h","_this","va","_this2","utc","Y","pricing","_pf","console","TKTApi","addPassToCart","unusedInput","overflow","charsLeftOver","nullInput","postal","invalidMonth","show_success","userInvalidated","alert","parsedDateParts","publish","$wrappers","id","$field","msg","n","show_error","isNaN","_d","getTime","empty","invalidWeekday","weekdayMismatch","invalidFormat","meridiem","_strict","unusedTokens","bigHour","isFrozen","sync_pass_form","_isValid","fields_to_show","f","_","each","w","attr","replace","Array","includes","some","required","fadeIn","detach","k","_isAMomentObject","o","_i","_f","_l","_tzm","_isUTC","_offset","_locale","d"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Show a pass buy form\n *\n * Usage:\n *\n * <div\n *    <!-- Required -->\n *    data-component=\"Pass/BuyForm\"\n * >\n */\ndefine([\n        'config', 'postal', 'lodash', 'jquery', 'jqueryjson', 'api', 'i18n'\n    ], function dependencies(\n        config, postal, _, $, $json, TKTApi, i18n) {\n\n    function BuyForm($container, state) {\n        this.$container = $container;\n        this.$pass      = $('.pass', this.$container);\n\n        // Ensure $pass is always an array\n        if ('object' === typeof this.$pass)\n            this.$pass = [this.$pass];\n\n        this.$selected_pass = this.$pass[0];\n\n        this.$wrappers = $('.field-wrapper', this.$container);\n        this.$fields   = $('.field-wrapper .field', this.$container);\n    }\n\n    BuyForm.prototype = {\n        attach: function() {\n            this.init();\n        },\n\n        init: function() {\n            if (this.$pass.length == 1)\n                this.sync_pass_form(this.$pass[0].data('type'));\n\n            $('button[type=\"submit\"]', this.$container).click((e) => {\n                e.preventDefault();\n                this.add_to_cart();\n            });\n        },\n\n        add_to_cart: function() {\n            let userdata = $('.field:visible,.opaque_field', this.$container)\n                .filter(function(i) { return !!($(this).val()); })\n                .serializeJSON();\n            console.log(userdata);\n            userdata.no_photo = true;\n\n            this.$selected_pass = $('.choose-pass:checked', this.$container).parents('.pass');\n            let type            = this.$selected_pass.data('type');\n\n            const pricing = $('.choose-pass:checked', this.$container).val();\n            if (!pricing)\n                return this.show_error(i18n.t('Veuillez choisir un tarif'));\n\n            TKTApi.addPassToCart(type, pricing, userdata, (err, status, rsp) => {\n                if (err)\n                    return this.show_error(i18n.t('Une erreur est survenue. Veuillez ré-essayer ultérieurement.'));\n\n                /*\n                const cart_url = config.get('cart_url');\n                if (cart_url)\n                    window.location.href = cart_url;\n                else\n                    this.show_success(i18n.t('Votre panier a été mis à jour'));\n                    */\n\n                postal.publish({\n                    channel: \"cart\",\n                    topic: \"reload\"\n                });\n            });\n        },\n\n        show_success(msg) {\n            alert(msg);\n        },\n\n        show_error(msg) {\n            alert(msg);\n        },\n\n        sync_pass_form: function (pass) {\n            let fields_to_show = $('#' + pass + '-fields').val().split(',');\n\n            // Set not required and hide all fields\n            $('.field', this.$container).each(function (i) {\n                $(this).required = false;\n            });\n            this.$wrappers.hide();\n\n            _.each(this.$wrappers, (w) => {\n                // Set required and show requested fields\n                let id     = $(w).attr('id').replace('field-wrapper-', '');\n                let $field = $('#' + id);\n                if (fields_to_show.includes(id)) {\n                    $field.required = true;\n                    $(w).fadeIn();\n                }\n            });\n        },\n\n        detach: function() {\n\n        }\n    };\n\n    return BuyForm;\n});\n"]}