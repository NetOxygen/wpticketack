{"version":3,"sources":["app/Booking/Form.js"],"names":["define","dependencies","config","postal","_","Template","$","TKTApi","moment","CartModel","Screening","Ticket","Form","$container","state","initialized","ids","data","split","show_on_load","parseInt","getUrlParam","selected_screening","prototype","attach","_this","init_store","click","e","preventDefault","deinit","init","subscribe","channel","topic","callback","envelope","check_bookability","_this2","getScreeningsInfo","err","status","rsp","screenings","map","s","screening","eligible_types","sortBy","start_at","build_form","pricings","pass_infos","ticket","bookability","reset_store_on_screening_change","html","emit_cart_update","cart","publish","emit_connection_update","process_add_to_cart","_this3","addClass","chosen_pricings","find","nb","removeClass","addToCart","_id","errorMsg","loadCart","book","_this4","Error","flash","error","success","connect_pass","_this5","number","key","loginTicket","_this6","checkBookability","ticket_logged_in","ticket_can_book_screening","msg","screening_already_booked","$dates_form","appendTo","$tickets_form","$success_panel","build_dates_form","build_success_panel","_this7","render","$date","target","select_screening","build_tickets_form","_this8","change","$input","val","bind","program_url","get","cart_url","screening_id","name","url","window","location","href","replace","regex","RegExp","results","exec","decodeURIComponent","detach"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Show a booking form\n *\n * Usage:\n *\n * <div\n *    <!-- Required -->\n *    data-component=\"Booking/Form\"\n *    data-ids=\"12345678-1234-1234-1234-123456789012,...\"\n * >\n */\ndefine( [\n        'config', 'postal', 'lodash',\n        'template', 'jquery', 'api',\n        'moment', 'Cart', 'Screening', 'Ticket'\n    ], function dependencies(\n        config, postal, _,\n        Template, $, TKTApi,\n        moment, CartModel, Screening, Ticket) {\n\n    function Form($container, state) {\n        this.$container  = $container;\n        this.initialized = false;\n\n        this.ids                = this.$container.data('ids').split(',');\n        this.show_on_load       = parseInt(this.getUrlParam('book')) == 1;\n        this.selected_screening = this.getUrlParam('s_id');\n    }\n\n    Form.prototype = {\n        attach: function() {\n            this.init_store();\n\n            $('.show-booking-form').click((e) => {\n                e.preventDefault();\n\n                if (this.initialized)\n                    return this.deinit();\n\n                this.init();\n            });\n\n            postal.subscribe({\n                channel: \"connection\",\n                topic: \"update\",\n                callback: (data, envelope) => {\n                    this.check_bookability();\n                }\n            });\n\n            if (this.show_on_load)\n                this.init();\n        },\n\n        init: function() {\n            TKTApi.getScreeningsInfo(this.ids, (err, status, rsp) => {\n                this.data.screenings = rsp.map((s) => {\n                    let screening = new Screening(s);\n                    screening.eligible_types = s.eligible_types;\n\n                    return screening;\n                });\n                this.data.screenings = _.sortBy(this.data.screenings, (s) => s.start_at);\n                this.build_form();\n                this.initialized = true;\n            });\n        },\n\n        init_store: function() {\n            this.data = {\n                screenings: [], // current screenings\n                screening: {},  // selected screening\n                pricings: [],   // selected screening pricings\n                pass_infos: {}, // connection infos\n                ticket: {},     // active ticket\n                bookability: {} //selected screening bookability with  active ticket\n            };\n        },\n\n        reset_store_on_screening_change: function() {\n            this.data.screening   = {};\n            this.data.pricings    = {};\n            this.data.pass_infos  = {};\n            this.data.bookability = {};\n        },\n\n        deinit: function() {\n            this.$container.html(\"\");\n            this.initialized = false;\n        },\n\n        emit_cart_update: function(cart) {\n            postal.publish({\n                channel: \"cart\",\n                topic: \"update\",\n                data: {\n                    cart: cart\n                }\n            });\n        },\n\n        emit_connection_update: function(ticket) {\n            postal.publish({\n                channel: \"connection\",\n                topic: \"update\",\n                data: {\n                    ticket: ticket\n                }\n            });\n        },\n\n        process_add_to_cart: function() {\n            $('.pricings-error').html(\"\").addClass('d-none');\n\n            // Check chosen pricings\n            const chosen_pricings = _.find(this.data.pricings, (nb) => nb > 0);\n            if (!chosen_pricings) {\n                return $('.pricings-error')\n                    .html('Veuillez choisir au moins un billet')\n                    .removeClass('d-none');\n            }\n\n            // Add to cart\n            TKTApi.addToCart(\n                this.data.screening._id,\n                this.data.pricings,\n                (err, status, rsp) => {\n                    if (err) {\n                        return $('.pricings-error')\n                            .html(rsp.errorMsg)\n                            .removeClass('d-none');\n                    }\n\n                // Hide forms and show success message\n                $('.dates-form, .tickets-form').addClass('d-none');\n                $('.success-panel').removeClass('d-none');\n\n                // Reload and emit cart update\n                TKTApi.loadCart((err, status, rsp) => {\n                    if (err)\n                        return;\n\n                    this.emit_cart_update(new CartModel(rsp));\n                });\n            });\n        },\n\n        book: function() {\n            if (!this.data.screening._id)\n                return new Error(\"No screening\");\n\n            TKTApi.book(this.data.screening._id, (err, status, rsp) => {\n                if (err) {\n                    $('.book-form-success', this.$container).addClass('d-none');\n                    $('.book-form-error', this.$container)\n                        .html(\"Une erreur est survenue. Veuillez ré-essayer ultérieurement.\")\n                        .removeClass('d-none');\n                } else if (rsp.flash && rsp.flash.error) {\n                    $('.book-form-success', this.$container).addClass('d-none');\n                    $('.book-form-error', this.$container)\n                        .html(rsp.flash.error)\n                        .removeClass('d-none');\n                } else {\n                    $('.book-form-error', this.$container).addClass('d-none');\n                    $('.book-form-success', this.$container)\n                        .html(rsp.flash.success)\n                        .removeClass('d-none');\n                }\n\n                this.check_bookability();\n            });\n        },\n\n        connect_pass: function() {\n            $('.pass-error', this.$container).html(\"\").addClass('d-none');\n\n            if (!this.data.pass_infos.number || !this.data.pass_infos.key)\n                return $('.pass-error')\n                    .html('Veuillez remplir les deux champs')\n                    .removeClass('d-none');\n\n            TKTApi.loginTicket(\n                this.data.pass_infos.number,\n                this.data.pass_infos.key,\n                (err, status, rsp) => {\n                    if (err)\n                        return $('.pass-error')\n                            .html('Les informations que vous avez saisies sont invalides')\n                            .removeClass('d-none');\n\n                    this.data.ticket = new Ticket(rsp);\n                    this.emit_connection_update(this.data.ticket);\n                }\n            );\n        },\n\n        check_bookability: function(callback) {\n            if (!this.data.screening._id)\n                return new Error(\"No screening\");\n\n            TKTApi.checkBookability(this.data.screening._id, (err, status, rsp) => {\n                if (err)\n                    return false;\n\n                this.data.bookability = rsp;\n\n                if (this.data.bookability.ticket_logged_in) {\n                    $('.connect-panel', this.$container).addClass('d-none');\n                    $('.book-panel', this.$container).removeClass('d-none');\n                    $('.show-bookings-btn', this.$container).removeClass('d-none');\n\n                    if (this.data.bookability.ticket_can_book_screening) {\n                        $('.book-btn', this.$container).removeClass('d-none');\n                        $('.book-form-error', this.$container).addClass('d-none');\n                    } else {\n                        $('.book-btn', this.$container).addClass('d-none');\n                        const msg = this.data.bookability.screening_already_booked ?\n                            \"Vous ne pouvez pas réserver plus de place pour cette séance avec votre abonnement.\" :\n                            \"Vous ne pouvez pas réserver de place pour cette séance avec votre abonnement.\";\n                        $('.book-form-error', this.$container)\n                            .html(msg)\n                            .removeClass('d-none');\n                    }\n                } else {\n                    $('.connect-panel', this.$container).removeClass('d-none');\n                    $('.book-panel', this.$container).addClass('d-none');\n                }\n            });\n        },\n\n        build_form: function() {\n            this.$container.html(\"\");\n            this.$dates_form    = $('<div class=\"dates-form\"></div>').appendTo(this.$container);\n            this.$tickets_form  = $('<div class=\"tickets-form\"></div>').appendTo(this.$container);\n            this.$success_panel = $('<div class=\"success-panel d-none\"></div>').appendTo(this.$container);\n\n            this.build_dates_form();\n            this.build_success_panel();\n        },\n\n        build_dates_form: function() {\n            // render template\n            this.$dates_form.html(Template.render('tkt-booking-form-dates-tpl', {\n                screenings: this.data.screenings,\n            }));\n\n            // bind dates choices\n            $('.date-wrapper span.date').click((e) => {\n                const $date = $(e.target);\n                this.select_screening($date.data('screening_id'));\n            });\n\n            // Select first date\n            this.select_screening(this.selected_screening ?\n                this.selected_screening :\n                this.data.screenings[0]._id\n            );\n        },\n\n        build_tickets_form: function() {\n            // render template\n            this.$tickets_form.html(Template.render('tkt-booking-form-pricings-tpl', {\n                screening: this.data.screening\n            }));\n\n            // bind pricing fields\n            $('.pricing-input', this.$container).change((e) => {\n              const $input = $(e.target);\n              this.data.pricings[$input.data('pricing')] = parseInt($input.val());\n            });\n\n            // bind pass panel toggler\n            $('a.show-connect-panel-form', this.$container).click((e) => {\n                e.preventDefault();\n                $('.connect-panel-form').removeClass('d-none');\n            });\n\n            // bind pass fields\n            $('.pass-number-input,.pass-key-input', this.$container).change((e) => {\n              this.data.pass_infos = {\n                number: $('.pass-number-input', this.$container).val(),\n                key: $('.pass-key-input', this.$container).val()\n              };\n            });\n\n            // bind pass connect button\n            $('.connect-btn', this.$container).click(this.connect_pass.bind(this));\n\n            // bind book button\n            $('.book-btn').click(this.book.bind(this));\n\n            // bind add-to-cart button\n            $('.add-to-cart-btn').click((e) => {\n              this.process_add_to_cart();\n            });\n        },\n\n        build_success_panel: function() {\n            // render template\n            this.$success_panel.html(Template.render('tkt-booking-form-success-tpl', {\n                program_url: config.get('program_url'),\n                cart_url: config.get('cart_url')\n            }));\n        },\n\n        select_screening: function (screening_id) {\n            $('.date-wrapper .date').removeClass('active');\n            $('.date-wrapper .date[data-screening_id=\"' + screening_id + '\"]').addClass('active');\n\n            // reset data\n            this.reset_store_on_screening_change();\n\n            this.data.screening = _.find(this.data.screenings, (s) => s._id === screening_id );\n            this.build_tickets_form();\n\n            this.check_bookability();\n        },\n\n        getUrlParam(name) {\n            const url = window.location.href;\n            name = name.replace(/[\\[\\]]/g, '\\\\$&');\n            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n                results = regex.exec(url);\n            if (!results) return null;\n            if (!results[2]) return '';\n            return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n        },\n\n        detach: function() {\n\n        }\n    };\n\n    return Form;\n});\n"]}