{"version":3,"sources":["app/Pass/BuyForm.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","define","dependencies","config","postal","_","Template","$","TKTApi","moment","CartModel","Screening","Ticket","BuyForm","$container","state","$pass","$selected_pass","$wrappers","$fields","attach","init","_this","length","sync_pass_form","data","click","e","preventDefault","add_to_cart","_this2","userdata","each","f","name","attr","replace","val","no_photo","pricing","parents","type","show_error","addPassToCart","err","status","rsp","show_success","publish","channel","topic","msg","alert","pass","fields","split","w","field","includes","detach"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Show a pass buy form\n *\n * Usage:\n *\n * <div\n *    <!-- Required -->\n *    data-component=\"Pass/BuyForm\"\n * >\n */\ndefine( [\n        'config', 'postal', 'lodash',\n        'template', 'jquery', 'api',\n        'moment', 'Cart', 'Screening', 'Ticket'\n    ], function dependencies(\n        config, postal, _,\n        Template, $, TKTApi,\n        moment, CartModel, Screening, Ticket) {\n\n    function BuyForm($container, state) {\n        this.$container = $container;\n        this.$pass      = $('.pass', this.$container);\n\n        // Ensure $pass is always an array\n        if ('object' === typeof this.$pass)\n            this.$pass = [this.$pass];\n\n        this.$selected_pass = this.$pass[0];\n\n        this.$wrappers = $('.field-wrapper', this.$container);\n        this.$fields   = $('.field-wrapper .field', this.$container);\n    }\n\n    BuyForm.prototype = {\n        attach: function() {\n            this.init();\n        },\n\n        init: function() {\n            if (this.$pass.length == 1)\n                this.sync_pass_form(this.$pass[0].data('type'));\n\n            $('button[type=\"submit\"]', this.$container).click((e) => {\n                e.preventDefault();\n                this.add_to_cart();\n            });\n        },\n\n        add_to_cart: function() {\n            let userdata = {};\n            _.each($('.field:visible', this.$container), (f) => {\n                let name = $(f).attr('id').replace('user_', '');\n                userdata[name] = $(f).val();\n            });\n            userdata.no_photo = true;\n            const pricing = $('.choose-pass:checked', this.$container).val();\n            this.$selected_pass = $('.choose-pass:checked', this.$container).parents('.pass');\n            let type = this.$selected_pass.data('type');\n            if (!pricing)\n                return this.show_error('Veuillez choisir un tarif');\n            TKTApi.addPassToCart(type, pricing, userdata, (err, status, rsp) => {\n                if (err)\n                    return this.show_error('Une erreur est survenue');\n\n                this.show_success(\"L'abonnement a été ajouté à votre panier\");\n\n                postal.publish({\n                    channel: \"cart\",\n                    topic: \"reload\"\n                });\n            });\n        },\n\n        show_success(msg) {\n            alert(msg);\n        },\n\n        show_error(msg) {\n            alert(msg);\n        },\n\n        sync_pass_form: function (pass) {\n            let fields = $('#' + pass + '-fields').val().split(',');\n            _.each(this.$wrappers, (w) => {\n                let field = $(w).attr('id').replace('field-wrapper-', '');\n                $(w)[fields.includes(field) ? 'fadeIn' : 'hide']();\n            });\n        },\n\n        detach: function() {\n\n        }\n    };\n\n    return BuyForm;\n});\n"]}