{"version":3,"sources":["ext/ticketack.js"],"names":["Ticketack","eshopUrl","apiKey","lang","session_id","localStorage","getItem","undefined","cartViewUrl","ticketViewUrl","passesViewUrl","screeningViewUrl","cartJsonUrl","cartRemoveUrl","cartAddUrl","cartAddArticlesUrl","screeningUrl","bookUrl","unbookUrl","checkUrl","loginUrl","logoutUrl","updateTicketEmailUrl","passesUrl","prototype","getCartViewUrl","url","parametrize_url","getTicketViewUrl","getPassesViewUrl","tickettype_id","pricing_id","params","tickettype","pricing","getScreeningViewUrl","screening_ref","loadCart","callback","that","get","err","status","rsp","setItem","getScreeningsInfo","screening_refs","join","addToCart","screening_id","data","post","addPassToCart","pass","userdata","headers","PHPSESSID","addArticlesToCart","articles","request","removeFromCart","index","checkBookability","loginTicket","number","key","logoutTicket","viewTicket","updateTicketEmail","email","patch","book","unbook","booking_id","getPasses","format","json","arguments","length","query","push","i","method","JSON","stringify","$","ajax","type","crossDomain","xhrFields","withCredentials","done","textStatus","jqXHR","responseJSON","fail","responseText","parse","Error","root","factory","define","amd","jQuery","self"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Ticketack integration class\n *\n * This class can manage all the Ticketack public API calls:\n *     - Compute URLs to view user cart, user pass (bookings), show screening\n *       page and buy pass page on the Ticketack eshop\n *     - Load the user cart\n *     - Add a screening to the user cart\n *     - Remove a screening from the user cart\n *     - Check a screening bookability\n *     - Login with a ticket\n *     - Book a screening with a ticket\n *     - Cancel a booking on a ticket\n *     - List the available passes\n *     - Update e-mail information in ticket\n *\n * @version 5.0.1 - 2018-03-13\n *\n * @copyright NetOxygen 2015-2018\n *\n * @param {String} eshopUrl: The Ticketack instance base URL\n * @param {String} apiKey: The API key\n * @param {String} lang: The language\n */\nvar Ticketack = function(eshopUrl, apiKey, lang) {\n\n    this.session_id            = localStorage.getItem('tkt_session_id') != undefined ? localStorage.getItem('tkt_session_id') : \"\";\n    this.eshopUrl              = eshopUrl;\n    this.apiKey                = apiKey;\n    this.lang                  = lang ? lang : '';\n\n    this.cartViewUrl           = this.eshopUrl + \"cart/view/\";\n    this.ticketViewUrl         = this.eshopUrl + \"ticket/view/\";\n    this.passesViewUrl         = this.eshopUrl + \"pass/new/\";\n    this.screeningViewUrl      = this.eshopUrl + \"screening/buy/\";\n\n    this.cartJsonUrl           = this.eshopUrl + \"cart/view_json\";\n    this.cartRemoveUrl         = this.eshopUrl + \"cart/remove\";\n    this.cartAddUrl            = this.eshopUrl + \"screening/buy/\";\n    this.cartAddArticlesUrl    = this.eshopUrl + \"article/add_variants_to_cart\";\n    this.screeningUrl          = this.eshopUrl + \"screening/info_json/\";\n    this.bookUrl               = this.eshopUrl + \"screening/book_on_ticket/\";\n    this.unbookUrl             = this.eshopUrl + \"ticket/cancel_booking_json/\";\n    this.checkUrl              = this.eshopUrl + \"screening/bookability/\";\n    this.loginUrl              = this.eshopUrl + \"ticket/view_json/\";\n    this.logoutUrl             = this.eshopUrl + \"ticket/disable_book_mode_json/\";\n    this.updateTicketEmailUrl  = this.eshopUrl + \"tickets/contact_email/\";\n    this.passesUrl             = this.eshopUrl + \"pass/tickettypes_json/\";\n};\n\n/**\n * User cart url getter\n */\nTicketack.prototype.getCartViewUrl   = function() {\n    var url = this.parametrize_url(this.cartViewUrl, {});\n    return url;\n}\n\n/**\n * User ticket url getter\n */\nTicketack.prototype.getTicketViewUrl = function() {\n    var url = this.parametrize_url(this.ticketViewUrl, {});\n    return url;\n}\n\n/**\n * Buy pass url getter (optional tickettype_id and pricing_id to select specific pass)\n */\nTicketack.prototype.getPassesViewUrl = function(tickettype_id, pricing_id) {\n    var params = {};\n    if (tickettype_id) {\n        params.tickettype = tickettype_id;\n        if (pricing_id) {\n            params.pricing = pricing_id;\n        }\n    }\n    var url = this.parametrize_url(this.passesViewUrl, params);\n    return url;\n}\n\n/**\n * Buy screening url getter\n */\nTicketack.prototype.getScreeningViewUrl = function(screening_ref) {\n    var url = this.parametrize_url(this.screeningViewUrl + screening_ref, {});\n    return url;\n}\n\n/**\n * Fetch cart data from Eshop\n *\n * @param {Function} callback: The callback function\n */\nTicketack.prototype.loadCart = function(callback) {\n    var that = this;\n    var url = this.parametrize_url(this.cartJsonUrl, {}, true);\n\n    return this.get(url, {}, function (err, status, rsp) {\n        if (err)\n            return callback && callback(err, status, rsp);\n\n        localStorage.setItem('tkt_session_id', rsp.session_id);\n        that.session_id = rsp.session_id;\n\n        return callback && callback(null, status, rsp);\n    });\n};\n\n/**\n * Fetch the informations about a screening\n *\n * @param {Array} screening_refs: Array with screening_refs\n * @param {Function} callback: The callback function\n */\nTicketack.prototype.getScreeningsInfo = function(screening_refs, callback) {\n    var url = this.parametrize_url(this.screeningUrl, { \"ids\": screening_refs.join(\",\") }, true);\n    return this.get(url, {}, callback);\n}\n\n/**\n * Add a screening to cart\n *\n * @param {UUID|Number} screening_id: The screening ID\n * @param {Object} pricing: An object containing pricing properties. Ex: {\"reduced\": 1, \"fullprice\": 2}\n * @param {Function} callback: The callback function\n */\nTicketack.prototype.addToCart = function(screening_id, pricing, callback) {\n    var data = {\n        \"id\":        screening_id,\n        \"pricing\":   pricing || {}\n    };\n    return this.post(this.cartAddUrl + screening_id, data, callback);\n};\n\n/**\n * Add a pass to cart\n *\n * @param {String} pass: The pass type\n * @param {String} pricing: The pricing key\n * @param {Object} userdata: The user data\n * @param {Function} callback: The callback function\n */\nTicketack.prototype.addPassToCart = function(pass, pricing, userdata, callback) {\n    headers = {};\n    headers['X-API-Key']    = this.apiKey;\n    headers['Content-type'] = undefined;\n\n    userdata.pass = pass + ':' + pricing;\n    let data = {\n        \"user\": userdata,\n        \"format\": \"json\"\n    };\n    if (this.session_id)\n        data.PHPSESSID = this.session_id;\n\n    return this.post(this.passesViewUrl, data, callback);\n};\n\n/**\n * Add articles to cart\n *\n * @param {Array} articles: An array of articles with the following properties:\n *                          - _id: the article _id\n *                          - variants: an arraay of {\n *                              \"_id\": the variant _id,\n *                              \"quantity\": the quantity,\n *                              \"price\": the variant price\n *                          }\n * @param {Function} callback: The callback function\n */\nTicketack.prototype.addArticlesToCart = function(articles, callback) {\n    var data = { \"articles\":  articles };\n    return this.request(\n        'POST',\n        this.cartAddArticlesUrl,\n        data,\n        { \"Content-type\": \"application/json\" },\n        callback\n    );\n};\n\n/**\n * Remove screening from cart\n *\n * @param {Number} index: The screening index in cart\n * @param {Function} callback: The callback function\n */\nTicketack.prototype.removeFromCart = function(index, callback) {\n    var data = { \"index\": index };\n    return this.post(this.cartRemoveUrl, data, callback);\n}\n\n/**\n * Screening bookability check\n *\n * Check if the user can book the screening\n *\n * @param {UUID|Number} screening_ref: The screening ID\n * @param {Function} callback: The callback function\n */\nTicketack.prototype.checkBookability = function(screening_ref, callback) {\n    var url = this.parametrize_url(this.checkUrl + screening_ref, {}, true);\n    return this.get(url, {}, callback);\n};\n\n/**\n * Ticket authentication\n *\n * Authenticates the user ticket\n *\n * @param number: The ticket number\n * @param key: The ticket key\n * @param callback\n */\nTicketack.prototype.loginTicket = function(number, key, callback) {\n    var data    = {\n        \"ticket_number\": number,\n        \"ticket_key\":    key\n    };\n\n    return this.post(this.loginUrl, data, callback);\n};\n\n/**\n * Ticket logout\n *\n * Logs out the user ticket\n *\n * @param callback\n */\nTicketack.prototype.logoutTicket = function(callback) {\n    return this.get(this.logoutUrl, {}, callback);\n};\n\n/**\n * Ticket view\n *\n * retrieve the current(connected) ticket informations\n *\n * @param callback\n */\nTicketack.prototype.viewTicket = function(callback) {\n    return this.post(this.loginUrl, {}, callback);\n};\n\n/**\n * Update user's e-mail address\n *\n * retrieve the current(connected) ticket informations\n *\n * @param callback\n */\nTicketack.prototype.updateTicketEmail = function(email, callback) {\n    var url = this.parametrize_url(this.updateTicketEmailUrl, {}, true);\n    return this.patch(url, { \"email\": email }, callback);\n}\n\n/**\n *\n * Book screening\n *\n * @param screening_id: The screening ID\n * @param callback\n */\nTicketack.prototype.book = function(screening_id, callback) {\n    return this.post(this.bookUrl + screening_id, {}, callback);\n};\n\n/**\n *\n * Cancel a booking\n *\n * @param {UUID|Number} booking_id: The booking ID\n * @param {Function} callback\n */\nTicketack.prototype.unbook = function(booking_id, callback) {\n    return this.post(this.unbookUrl + booking_id, {}, callback);\n};\n\n/**\n *\n * List the available passes\n *\n * @param {Function} callback\n */\nTicketack.prototype.getPasses = function(callback) {\n    var url = this.parametrize_url(this.passesUrl, {}, true);\n    return this.get(url, {}, callback);\n};\n\n/**\n * Make an HTTP GET request\n *\n * @param {String} url\n * @param {Object} data\n * @param {Function} callback\n */\nTicketack.prototype.get = function(url, data, callback) {\n    return this.request('GET', url, data, {}, callback);\n};\n\n/**\n * Make an HTTP POST request\n *\n * @param {String} url\n * @param {Object} data\n * @param {Function} callback\n */\nTicketack.prototype.post = function(url, data, callback) {\n    data        = data || {};\n    data.format = \"json\"\n    data.lang   = this.lang;\n    if (this.session_id)\n        data.PHPSESSID = this.session_id;\n    return this.request('POST', url, data, {}, callback);\n};\n\n/**\n * Make an HTTP PATCH request\n *\n * @param {String} url\n * @param {Object} data\n * @param {Function} callback\n */\nTicketack.prototype.patch = function(url, data, callback) {\n    // ALl requests in this lib should be sent with the application/json content type.\n    // For now, all but the one sent in PATCH (because it calls the \"new\" api/controllers),\n    // are using application/x-www-form-urlencoded.\n    // When all the calls are made to the new controllers, we should set the json\n    // content type by default\n    return this.request('PATCH', url, data, { \"Content-type\": \"application/json\" }, callback);\n};\n\nTicketack.prototype.parametrize_url = function(url, params, json = false) {\n    var query = [];\n\n    query.push(\"lang=\" + this.lang);\n\n    if (json)\n        query.push(\"format=json\");\n\n    if (this.session_id)\n        query.push(\"PHPSESSID=\" + this.session_id);\n\n    for (i in params) {\n        query.push(i + '=' + params[i]);\n    }\n\n    return url + '?' + query.join('&');\n}\n\n/**\n *\n * Make an HTTP request\n *\n * @param {Function} callback\n */\nTicketack.prototype.request = function(method, url, data, headers, callback) {\n    headers = headers || {};\n    headers['X-API-Key'] = this.apiKey;\n\n    if (headers['Content-type'] && headers['Content-type'] == 'application/json')\n        data = JSON.stringify(data);\n\n    return $.ajax(url, {\n        type: method,\n        data: data,\n        headers: headers,\n        crossDomain: true,\n        xhrFields: { withCredentials: true }\n    }).done(\n        function (data, textStatus, jqXHR) {\n            return callback(null, jqXHR.status, jqXHR.responseJSON);\n        }\n    ).fail(\n        function (jqXHR) {\n            var rsp = jqXHR.responseText.length ? JSON.parse(jqXHR.responseText) : null;\n            return callback(new Error(), jqXHR.status, rsp);\n        }\n    );\n};\n\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(['jquery'], function ($) {\n            return (root.Ticketack = factory($));\n        });\n    } else {\n        // Browser globals\n        root.Ticketack = factory(root.jQuery);\n    }\n}(typeof self !== 'undefined' ? self : this, function ($) {\n    return Ticketack;\n}));\n"]}